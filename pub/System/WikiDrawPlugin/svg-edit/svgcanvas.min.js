if(!window.console){window.console={};window.console.log=function(a){};window.console.dir=function(a){}}if(window.opera){window.console.log=function(a){opera.postError(a)};window.console.dir=function(a){}}(function(){var a=jQuery.fn.attr,b="http://www.w3.org/2000/svg";jQuery.fn.attr=function(o,l){var g=this.length;if(!g){return this}for(var f=0;f<g;f++){var c=this[f];if(c.namespaceURI===b){if(l!==undefined){c.setAttribute(o,l)}else{if($.isArray(o)){var d=o.length,e={};while(d--){var k=o[d];var h=c.getAttribute(k);if(h||h==="0"){h=isNaN(h)?h:h-0}e[k]=h}return e}else{if(typeof o==="object"){for(var m in o){c.setAttribute(m,o[m])}}else{var h=c.getAttribute(o);if(h||h==="0"){h=isNaN(h)?h:h-0}return h}}}}else{return a.apply(this,arguments)}}return this}}());$.SvgCanvas=function(aU,aG){var k=!!window.opera,aK=navigator.userAgent.indexOf("AppleWebKit")!=-1,bg={},aO={a:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","mask","opacity","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","xlink:href","xlink:title"],circle:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","r","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],clipPath:["class","clipPathUnits","id"],defs:[],desc:[],ellipse:["class","clip-path","clip-rule","cx","cy","fill","fill-opacity","fill-rule","filter","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],feGaussianBlur:["class","color-interpolation-filters","id","requiredFeatures","stdDeviation"],filter:["class","color-interpolation-filters","filterRes","filterUnits","height","id","primitiveUnits","requiredFeatures","width","x","xlink:href","y"],foreignObject:["class","font-size","height","id","opacity","requiredFeatures","style","transform","width","x","y"],g:["class","clip-path","clip-rule","id","display","fill","fill-opacity","fill-rule","filter","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],image:["class","clip-path","clip-rule","filter","height","id","mask","opacity","requiredFeatures","style","systemLanguage","transform","width","x","xlink:href","xlink:title","y"],line:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","x1","x2","y1","y2"],linearGradient:["class","id","gradientTransform","gradientUnits","requiredFeatures","spreadMethod","systemLanguage","x1","x2","xlink:href","y1","y2"],marker:["id","class","markerHeight","markerUnits","markerWidth","orient","preserveAspectRatio","refX","refY","systemLanguage","viewBox"],mask:["class","height","id","maskContentUnits","maskUnits","width","x","y"],metadata:["class","id"],path:["class","clip-path","clip-rule","d","fill","fill-opacity","fill-rule","filter","id","marker-end","marker-mid","marker-start","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],pattern:["class","height","id","patternContentUnits","patternTransform","patternUnits","requiredFeatures","style","systemLanguage","width","x","xlink:href","y"],polygon:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","id","class","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],polyline:["class","clip-path","clip-rule","id","fill","fill-opacity","fill-rule","filter","marker-end","marker-mid","marker-start","mask","opacity","points","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform"],radialGradient:["class","cx","cy","fx","fy","gradientTransform","gradientUnits","id","r","requiredFeatures","spreadMethod","systemLanguage","xlink:href"],rect:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","opacity","requiredFeatures","rx","ry","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","width","x","y"],stop:["class","id","offset","requiredFeatures","stop-color","stop-opacity","style","systemLanguage"],svg:["class","clip-path","clip-rule","filter","id","height","mask","preserveAspectRatio","requiredFeatures","style","systemLanguage","viewBox","width","x","xmlns","xmlns:se","xmlns:xlink","y"],"switch":["class","id","requiredFeatures","systemLanguage"],symbol:["class","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","opacity","preserveAspectRatio","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","transform","viewBox"],text:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","transform","x","xml:space","y"],textPath:["class","id","method","requiredFeatures","spacing","startOffset","style","systemLanguage","transform","xlink:href"],title:[],tspan:["class","clip-path","clip-rule","dx","dy","fill","fill-opacity","fill-rule","filter","font-family","font-size","font-style","font-weight","id","mask","opacity","requiredFeatures","rotate","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","systemLanguage","text-anchor","textLength","transform","x","xml:space","y"],use:["class","clip-path","clip-rule","fill","fill-opacity","fill-rule","filter","height","id","mask","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","style","transform","width","x","xlink:href","y"],annotation:["encoding"],"annotation-xml":["encoding"],maction:["actiontype","other","selection"],math:["class","id","display","xmlns"],menclose:["notation"],merror:[],mfrac:["linethickness"],mi:["mathvariant"],mmultiscripts:[],mn:[],mo:["fence","lspace","maxsize","minsize","rspace","stretchy"],mover:[],mpadded:["lspace","width"],mphantom:[],mprescripts:[],mroot:[],mrow:["xlink:href","xlink:type","xmlns:xlink"],mspace:["depth","height","width"],msqrt:[],mstyle:["displaystyle","mathbackground","mathcolor","mathvariant","scriptlevel"],msub:[],msubsup:[],msup:[],mtable:["align","columnalign","columnlines","columnspacing","displaystyle","equalcolumns","equalrows","frame","rowalign","rowlines","rowspacing","width"],mtd:["columnalign","columnspan","rowalign","rowspan"],mtext:[],mtr:["columnalign","rowalign"],munder:[],munderover:[],none:[],semantics:[]},aJ={pathNodeTooltip:"Drag node to move it. Double-click node to change segment type",pathCtrlPtTooltip:"Drag control point to adjust curve properties",exportNoBlur:"Blurred elements will appear as un-blurred",exportNoImage:"Image elements will not appear",exportNoforeignObject:"foreignObject elements will not appear",exportNoDashArray:"Strokes will appear filled",exportNoText:"Text may not appear as expected"},L={show_outside_canvas:true,dimensions:[640,480]};var aN="a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use";var bd=aN.split(",");if(aG){$.extend(L,aG)}var aE=this.Utils=function(){var bx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{toXml:function(by){return $("<p/>").text(by).html()},fromXml:function(by){return $("<p/>").html(by).text()},encode64:function(bB){bB=aE.convertToXMLReferences(bB);if(window.btoa){return window.btoa(bB)}var bz=new Array(Math.floor((bB.length+2)/3)*4);var bI,bG,bE;var bH,bF,bD,bC;var bA=0,by=0;do{bI=bB.charCodeAt(bA++);bG=bB.charCodeAt(bA++);bE=bB.charCodeAt(bA++);bH=bI>>2;bF=((bI&3)<<4)|(bG>>4);bD=((bG&15)<<2)|(bE>>6);bC=bE&63;if(isNaN(bG)){bD=bC=64}else{if(isNaN(bE)){bC=64}}bz[by++]=bx.charAt(bH);bz[by++]=bx.charAt(bF);bz[by++]=bx.charAt(bD);bz[by++]=bx.charAt(bC)}while(bA<bB.length);return bz.join("")},decode64:function(bA){if(window.atob){return window.atob(bA)}var by="";var bH,bF,bD="";var bG,bE,bC,bB="";var bz=0;bA=bA.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{bG=bx.indexOf(bA.charAt(bz++));bE=bx.indexOf(bA.charAt(bz++));bC=bx.indexOf(bA.charAt(bz++));bB=bx.indexOf(bA.charAt(bz++));bH=(bG<<2)|(bE>>4);bF=((bE&15)<<4)|(bC>>2);bD=((bC&3)<<6)|bB;by=by+String.fromCharCode(bH);if(bC!=64){by=by+String.fromCharCode(bF)}if(bB!=64){by=by+String.fromCharCode(bD)}bH=bF=bD="";bG=bE=bC=bB=""}while(bz<bA.length);return unescape(by)},convertToXMLReferences:function(bz){var by="";for(var bB=0;bB<bz.length;bB++){var bA=bz.charCodeAt(bB);if(bA<128){by+=bz[bB]}else{if(bA>127){by+=("&#"+bA+";")}}}return by},rectsIntersect:function(bz,by){return by.x<(bz.x+bz.width)&&(by.x+by.width)>bz.x&&by.y<(bz.y+bz.height)&&(by.y+by.height)>bz.y},snapToAngle:function(bz,bH,by,bF){var bB=Math.PI/4;var bJ=by-bz;var bI=bF-bH;var bA=Math.atan2(bI,bJ);var bD=Math.sqrt(bJ*bJ+bI*bI);var bC=Math.round(bA/bB)*bB;var bG=bz+bD*Math.cos(bC);var bE=bH+bD*Math.sin(bC);return{x:bG,y:bE,a:bC}},snapToGrid:function(bz){var by=L.snappingStep;bz=Math.round(bz/by)*by;return bz},text2xml:function(bz){if(bz.indexOf("<svg:svg")!==-1){bz=bz.replace(/<(\/?)svg:/g,"<$1").replace("xmlns:svg","xmlns")}var by;try{var bB=(window.DOMParser)?new DOMParser():new ActiveXObject("Microsoft.XMLDOM");bB.async=false}catch(bA){throw new Error("XML Parser could not be instantiated")}try{if(bB.loadXML){by=(bB.loadXML(bz))?bB:false}else{by=bB.parseFromString(bz,"text/xml")}}catch(bA){throw new Error("Error parsing XML string")}return by}}}();var aq=aE.snapToGrid;var a1=$.data;var bt=this,aT="http://www.w3.org/2000/svg",aM="http://www.w3.org/1999/xlink",Y="http://www.w3.org/XML/1998/namespace",bw="http://www.w3.org/2000/xmlns/",at="http://svg-edit.googlecode.com",Q="http://www.w3.org/1999/xhtml",f="http://www.w3.org/1998/Math/MathML",K={em:0,ex:0,px:1,cm:35.43307,mm:3.543307,"in":90,pt:1.25,pc:15,"%":0},m=Math.floor(Math.random()*100001),q=false,aV=aU.ownerDocument,A=L.dimensions;var I=aV.importNode(aE.text2xml('<svg id="svgroot" xmlns="'+aT+'" xlinkns="'+aM+'" width="'+A[0]+'" height="'+A[1]+'" x="'+A[0]+'" y="'+A[1]+'" overflow="visible"><defs><filter id="canvashadow" filterUnits="objectBoundingBox"><feGaussianBlur in="SourceAlpha" stdDeviation="4" result="blur"/><feOffset in="blur" dx="5" dy="5" result="offsetBlur"/><feMerge><feMergeNode in="offsetBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs></svg>').documentElement,true);aU.appendChild(I);var am=aV.createElementNS(aT,"svg");$(am).attr({id:"svgcontent",width:A[0],height:A[1],x:A[0],y:A[1],overflow:L.show_outside_canvas?"visible":"hidden",xmlns:aT,"xmlns:se":at,"xmlns:xlink":aM}).appendTo(I);if(q){am.setAttributeNS(at,"se:nonce",m)}var au={};au[aM]="xlink";au[Y]="xml";au[bw]="xmlns";au[at]="se";au[Q]="xhtml";au[f]="mathml";var br={};$.each(au,function(bx,by){br[by]=bx});var h={};$.each(aO,function(bx,bz){var by={};$.each(bz,function(bC,bB){if(bB.indexOf(":")!=-1){var bA=bB.split(":");by[bA[1]]=br[bA[0]]}else{by[bB]=bB=="xmlns"?bw:null}});h[bx]=by});var P=document.createElementNS(aT,"animate");$(P).attr({attributeName:"opacity",begin:"indefinite",dur:1,fill:"freeze"}).appendTo(I);var bi,av,ad;(function(){var bx=["x","x1","cx","rx","width"];var by=["y","y1","cy","ry","height"];var bz=$.merge(["r","radius"],bx);$.merge(bz,by);bi=function(bA,bE){if(!isNaN(bE)){return bE-0}if(bE.substr(-1)==="%"){var bB=bE.substr(0,bE.length-1)/100;var bC=d();if($.inArray(bA,bx)!==-1){return bB*bC.w}else{if($.inArray(bA,by)!==-1){return bB*bC.h}else{return bB*Math.sqrt((bC.w*bC.w)+(bC.h*bC.h))/Math.sqrt(2)}}}else{var bD=bE.substr(-2);var bB=bE.substr(0,bE.length-2);return bB*K[bD]}};ad=function(bE,bA,bF){if(!isNaN(bF)){var bC=bE.getAttribute(bA);if(bC!==null&&isNaN(bC)){var bD;if(bC.substr(-1)==="%"){var bB=d();bD="%";bF*=100;if($.inArray(bA,bx)!==-1){bF=bF/bB.w}else{if($.inArray(bA,by)!==-1){bF=bF/bB.h}else{return bF/Math.sqrt((bB.w*bB.w)+(bB.h*bB.h))/Math.sqrt(2)}}}else{bD=bC.substr(-2);bF=bF/K[bD]}bF+=bD}}bE.setAttribute(bA,bF)};bt.isValidUnit=function(bB,bF){var bD=false;if($.inArray(bB,bz)!=-1){if(!isNaN(bF)){bD=true}else{bF=bF.toLowerCase();$.each(K,function(bH){if(bD){return}var bG=new RegExp("^-?[\\d\\.]+"+bH+"$");if(bG.test(bF)){bD=true}})}}else{if(bB=="id"){var bA=false;try{var bC=b(bF);bA=(bC==null)}catch(bE){}return bA}else{bD=true}}return bD}})();this.undoCmd={};var aD=this.undoCmd.changeElement=function(bz,by,bA){this.elem=bz;this.text=bA?("Change "+bz.tagName+" "+bA):("Change "+bz.tagName);this.newValues={};this.oldValues=by;for(var bx in by){if(bx=="#text"){this.newValues[bx]=bz.textContent}else{if(bx=="#href"){this.newValues[bx]=bk(bz)}else{this.newValues[bx]=bz.getAttribute(bx)}}}this.apply=function(){var bE=false;for(var bC in this.newValues){if(this.newValues[bC]){if(bC=="#text"){this.elem.textContent=this.newValues[bC]}else{if(bC=="#href"){a2(this.elem,this.newValues[bC])}else{this.elem.setAttribute(bC,this.newValues[bC])}}}else{if(bC=="#text"){this.elem.textContent=""}else{this.elem.setAttribute(bC,"");this.elem.removeAttribute(bC)}}if(bC=="transform"){bE=true}else{if(bC=="stdDeviation"){bt.setBlurOffsets(this.elem.parentNode,this.newValues[bC])}}}if(!bE){var bG=az(bz);if(bG){var bF=bz.getBBox();var bB=bF.x+bF.width/2,bH=bF.y+bF.height/2;var bD=["rotate(",bG," ",bB,",",bH,")"].join("");if(bD!=bz.getAttribute("transform")){bz.setAttribute("transform",bD)}}}if(this.elem.tagName=="title"&&this.elem.parentNode.parentNode==am){aa()}return true};this.unapply=function(){var bE=false;for(var bC in this.oldValues){if(this.oldValues[bC]){if(bC=="#text"){this.elem.textContent=this.oldValues[bC]}else{if(bC=="#href"){a2(this.elem,this.oldValues[bC])}else{this.elem.setAttribute(bC,this.oldValues[bC])}}if(bC=="stdDeviation"){bt.setBlurOffsets(this.elem.parentNode,this.oldValues[bC])}}else{if(bC=="#text"){this.elem.textContent=""}else{this.elem.removeAttribute(bC)}}if(bC=="transform"){bE=true}}if(!bE){var bG=az(bz);if(bG){var bF=bz.getBBox();var bB=bF.x+bF.width/2,bH=bF.y+bF.height/2;var bD=["rotate(",bG," ",bB,",",bH,")"].join("");if(bD!=bz.getAttribute("transform")){bz.setAttribute("transform",bD)}}}if(this.elem.tagName=="title"&&this.elem.parentNode.parentNode==am){aa()}if(V[this.elem.id]){delete V[this.elem.id]}return true};this.elements=function(){return[this.elem]}};var a=this.undoCmd.insertElement=function(bx,by){this.elem=bx;this.text=by||("Create "+bx.tagName);this.parent=bx.parentNode;this.apply=function(){this.elem=this.parent.insertBefore(this.elem,this.elem.nextSibling);if(this.parent==am){aa()}};this.unapply=function(){this.parent=this.elem.parentNode;this.elem=this.elem.parentNode.removeChild(this.elem);if(this.parent==am){aa()}};this.elements=function(){return[this.elem]}};var T=this.undoCmd.removeElement=function(by,bx,bz){this.elem=by;this.text=bz||("Delete "+by.tagName);this.parent=bx;this.apply=function(){if(V[this.elem.id]){delete V[this.elem.id]}this.parent=this.elem.parentNode;this.elem=this.parent.removeChild(this.elem);if(this.parent==am){aa()}};this.unapply=function(){if(V[this.elem.id]){delete V[this.elem.id]}this.elem=this.parent.insertBefore(this.elem,this.elem.nextSibling);if(this.parent==am){aa()}};this.elements=function(){return[this.elem]};if(V[by.id]){delete V[by.id]}};var U=this.undoCmd.moveElement=function(by,bz,bx,bA){this.elem=by;this.text=bA?("Move "+by.tagName+" to "+bA):("Move "+by.tagName);this.oldNextSibling=bz;this.oldParent=bx;this.newNextSibling=by.nextSibling;this.newParent=by.parentNode;this.apply=function(){this.elem=this.newParent.insertBefore(this.elem,this.newNextSibling);if(this.newParent==am){aa()}};this.unapply=function(){this.elem=this.oldParent.insertBefore(this.elem,this.oldNextSibling);if(this.oldParent==am){aa()}};this.elements=function(){return[this.elem]}};var aI=this.undoCmd.batch=function(bx){this.text=bx||"Batch Command";this.stack=[];this.apply=function(){var by=this.stack.length;for(var bz=0;bz<by;++bz){this.stack[bz].apply()}};this.unapply=function(){for(var by=this.stack.length-1;by>=0;by--){this.stack[by].unapply()}};this.elements=function(){var by=[];var bB=this.stack.length;while(bB--){var bA=this.stack[bB].elements();var bz=bA.length;while(bz--){if(by.indexOf(bA[bz])==-1){by.push(bA[bz])}}}return by};this.addSubCommand=function(by){this.stack.push(by)};this.isEmpty=function(){return this.stack.length==0}};var a7;(function(bz){var bx=0,by=[];bz.undoMgr={resetUndoStack:function(){by=[];bx=0},getUndoStackSize:function(){return bx},getRedoStackSize:function(){return by.length-bx},getNextUndoCommandText:function(){if(bx>0){return by[bx-1].text}return""},getNextRedoCommandText:function(){if(bx<by.length){return by[bx].text}return""},undo:function(){if(bx>0){bz.clearSelection();var bA=by[--bx];bA.unapply();B.clear();call("changed",bA.elements())}},redo:function(){if(bx<by.length&&by.length>0){bz.clearSelection();var bA=by[bx++];bA.apply();B.clear();call("changed",bA.elements())}}};a7=bz.undoCmd.add=function(bA){if(bx<by.length&&by.length>0){by=by.splice(0,bx)}by.push(bA);bx=by.length}}(bt));(function(bz){var by=-1;var bx=[];bz.beginUndoableChange=function(bD,bB){var bG=++by;var bC=bB.length;var bA=new Array(bC),bF=new Array(bC);while(bC--){var bE=bB[bC];if(bE==null){continue}bF[bC]=bE;bA[bC]=bE.getAttribute(bD)}bx[bG]={attrName:bD,oldValues:bA,elements:bF}};bz.finishUndoableChange=function(){var bF=by--;var bG=bx[bF];var bC=bG.elements.length;var bB=bG.attrName;var bA=new aI("Change "+bB);while(bC--){var bE=bG.elements[bC];if(bE==null){continue}var bD={};bD[bB]=bG.oldValues[bC];if(bD[bB]!=bE.getAttribute(bB)){bA.addSubCommand(new aD(bE,bD,bB))}}bx[bF]=null;return bA}}(bt));var bu;(function(){function bx(bz,by){this.id=bz;this.selectedElement=by;this.locked=true;this.reset=function(bA){this.locked=true;this.selectedElement=bA;this.resize();this.selectorGroup.setAttribute("display","inline")};this.selectorGroup=c({element:"g",attr:{id:("selectorGroup"+this.id)}});this.selectorRect=this.selectorGroup.appendChild(c({element:"path",attr:{id:("selectedBox"+this.id),fill:"none",stroke:"#22C","stroke-width":"1","stroke-dasharray":"5,5",style:"pointer-events:none"}}));this.gripCoords={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};this.showGrips=function(bA){var bB=bA?"inline":"none";H.selectorGripsGroup.setAttribute("display",bB);var bC=this.selectedElement;if(bC&&bA){this.selectorGroup.appendChild(H.selectorGripsGroup);this.updateGripCursors(az(bC))}};this.updateGripCursors=function(bE){var bD=[];var bA=Math.round(bE/45);if(bA<0){bA+=8}for(var bB in H.selectorGrips){bD.push(bB)}while(bA>0){bD.push(bD.shift());bA--}var bC=0;for(var bB in H.selectorGrips){H.selectorGrips[bB].setAttribute("style",("cursor:"+bD[bC]+"-resize"));bC++}};this.resize=function(){var bA=this.selectorRect,b4=H,bH=b4.selectorGrips,bX=this.selectedElement,bV=bX.getAttribute("stroke-width");var bO=1/af;if(bX.getAttribute("stroke")!="none"&&!isNaN(bV)){bO+=(bV/2)}if(bX.tagName=="text"){bO+=2/af}var bB=aC(bX);if(bX.tagName=="g"&&!$(bX).data("gsvg")){var bM=aj(bX.childNodes);if(bM){var bN={};$.each(bB,function(b6,b7){bN[b6]=bM[b6]});bB=bN}}var bY=D(bX);bY.e*=af;bY.f*=af;var bZ=bB.x-bO,bS=bB.y-bO,bR=bB.width+(bO*2),b1=bB.height+(bO*2),bB={x:bZ,y:bS,width:bR,height:b1};var b3=bv(bZ*af,bS*af,bR*af,b1*af,bY),bD=b3.aabox.x,bC=b3.aabox.y,bE=b3.aabox.width,bQ=b3.aabox.height;var bG=bD+bE/2,bF=bC+bQ/2;var b2=az(bX);if(b2){var bP=I.createSVGTransform();bP.setRotate(-b2,bG,bF);var bT=bP.matrix;b3.tl=R(b3.tl.x,b3.tl.y,bT);b3.tr=R(b3.tr.x,b3.tr.y,bT);b3.bl=R(b3.bl.x,b3.bl.y,bT);b3.br=R(b3.br.x,b3.br.y,bT);var bL=b3.tl.x,bK=b3.tl.y,bJ=b3.tl.x,bI=b3.tl.y;bL=Math.min(bL,Math.min(b3.tr.x,Math.min(b3.bl.x,b3.br.x)));bK=Math.min(bK,Math.min(b3.tr.y,Math.min(b3.bl.y,b3.br.y)));bJ=Math.max(bJ,Math.max(b3.tr.x,Math.max(b3.bl.x,b3.br.x)));bI=Math.max(bI,Math.max(b3.tr.y,Math.max(b3.bl.y,b3.br.y)));bD=bL;bC=bK;bE=(bJ-bL);bQ=(bI-bK)}var b5=I.suspendRedraw(100);var bU="M"+bD+","+bC+" L"+(bD+bE)+","+bC+" "+(bD+bE)+","+(bC+bQ)+" "+bD+","+(bC+bQ)+"z";aH(bA,{d:bU});this.gripCoords={nw:[bD,bC],ne:[bD+bE,bC],sw:[bD,bC+bQ],se:[bD+bE,bC+bQ],n:[bD+(bE)/2,bC],w:[bD,bC+(bQ)/2],e:[bD+bE,bC+(bQ)/2],s:[bD+(bE)/2,bC+bQ]};if(bX==a3[0]){for(var bW in this.gripCoords){var b0=this.gripCoords[bW];aH(bH[bW],{cx:b0[0],cy:b0[1]})}}if(b2){this.selectorGroup.setAttribute("transform","rotate("+[b2,bG,bF].join(",")+")")}else{this.selectorGroup.setAttribute("transform","")}aH(b4.rotateGripConnector,{x1:bD+(bE)/2,y1:bC,x2:bD+(bE)/2,y2:bC-20});aH(b4.rotateGrip,{cx:bD+(bE)/2,cy:bC-20});I.unsuspendRedraw(b5)};this.reset(by)}bu=function(){this.selectorParentGroup=null;this.rubberBandBox=null;this.selectors=[];this.selectorMap={};var by=this;this.initGroup=function(){if(by.selectorParentGroup&&by.selectorParentGroup.parentNode){by.selectorParentGroup.parentNode.removeChild(by.selectorParentGroup)}by.selectorParentGroup=aV.createElementNS(aT,"g");by.selectorParentGroup.setAttribute("id","selectorParentGroup");by.selectorGripsGroup=aV.createElementNS(aT,"g");by.selectorGripsGroup.setAttribute("display","none");I.appendChild(by.selectorParentGroup);by.selectorParentGroup.appendChild(by.selectorGripsGroup);by.selectorMap={};by.selectors=[];by.rubberBandBox=null;by.selectorGrips={nw:null,n:null,ne:null,e:null,se:null,s:null,sw:null,w:null};for(var bB in by.selectorGrips){var bA=c({element:"circle",attr:{id:("selectorGrip_resize_"+bB),fill:"#22C",r:4,style:("cursor:"+bB+"-resize"),"stroke-width":2,"pointer-events":"all"}});a1(bA,"dir",bB);a1(bA,"type","resize");this.selectorGrips[bB]=by.selectorGripsGroup.appendChild(bA)}this.rotateGripConnector=this.selectorGripsGroup.appendChild(c({element:"line",attr:{id:("selectorGrip_rotateconnector"),stroke:"#22C","stroke-width":"1"}}));this.rotateGrip=this.selectorGripsGroup.appendChild(c({element:"circle",attr:{id:"selectorGrip_rotate",fill:"lime",r:4,stroke:"#22C","stroke-width":2,style:"cursor:url("+L.imgPath+"rotate.png) 12 12, auto;"}}));a1(this.rotateGrip,"type","rotate");if($("#canvasBackground").length){return}var bz=aV.createElementNS(aT,"svg");var bD=L.dimensions;aH(bz,{id:"canvasBackground",width:bD[0],height:bD[1],x:0,y:0,overflow:"visible",style:"pointer-events:none"});var bC=aV.createElementNS(aT,"rect");aH(bC,{width:"100%",height:"100%",x:0,y:0,"stroke-width":1,stroke:"#000",fill:"#FFF",style:"pointer-events:none"});bz.appendChild(bC);I.insertBefore(bz,am)};this.requestSelector=function(bA){if(bA==null){return null}var bB=this.selectors.length;if(typeof(this.selectorMap[bA.id])=="object"){this.selectorMap[bA.id].locked=true;return this.selectorMap[bA.id]}for(var bz=0;bz<bB;++bz){if(this.selectors[bz]&&!this.selectors[bz].locked){this.selectors[bz].locked=true;this.selectors[bz].reset(bA);this.selectorMap[bA.id]=this.selectors[bz];return this.selectors[bz]}}this.selectors[bB]=new bx(bB,bA);this.selectorParentGroup.appendChild(this.selectors[bB].selectorGroup);this.selectorMap[bA.id]=this.selectors[bB];return this.selectors[bB]};this.releaseSelector=function(bA){if(bA==null){return}var bD=this.selectors.length,bB=this.selectorMap[bA.id];for(var bz=0;bz<bD;++bz){if(this.selectors[bz]&&this.selectors[bz]==bB){if(bB.locked==false){console.log("WARNING! selector was released but was already unlocked")}delete this.selectorMap[bA.id];bB.locked=false;bB.selectedElement=null;bB.showGrips(false);try{bB.selectorGroup.setAttribute("display","none")}catch(bC){}break}}};this.getRubberBandBox=function(){if(this.rubberBandBox==null){this.rubberBandBox=this.selectorParentGroup.appendChild(c({element:"rect",attr:{id:"selectorRubberBand",fill:"#22C","fill-opacity":0.15,stroke:"#22C","stroke-width":0.5,display:"none",style:"pointer-events:none"}}))}return this.rubberBandBox};this.initGroup()}}());var V={};var J=function(by){function bx(bB){var bA=bB.matrix,bD="";switch(bB.type){case 1:bD="matrix("+[bA.a,bA.b,bA.c,bA.d,bA.e,bA.f].join(",")+")";break;case 2:bD="translate("+bA.e+","+bA.f+")";break;case 3:if(bA.a==bA.d){bD="scale("+bA.a+")"}else{bD="scale("+bA.a+","+bA.d+")"}break;case 4:var bz=0,bE=0;if(bB.angle!=0){var bC=1-bA.a;bE=(bC*bA.f+bA.b*bA.e)/(bC*bC+bA.b*bA.b);bz=(bA.e-bA.b*bE)/bC}bD="rotate("+bB.angle+" "+bz+","+bE+")";break}return bD}this._elem=by||null;this._xforms=[];this._update=function(){var bB="";var bA=I.createSVGMatrix();for(var bC=0;bC<this.numberOfItems;++bC){var bz=this._list.getItem(bC);bB+=bx(bz)+" "}this._elem.setAttribute("transform",bB)};this._list=this;this._init=function(){var bI=this._elem.getAttribute("transform");if(!bI){return}var bM=/\s*((scale|matrix|rotate|translate)\s*\(.*?\))\s*,?\s*/;var bF=[];var bE=true;while(bE){bE=bI.match(bM);bI=bI.replace(bM,"");if(bE&&bE[1]){var bJ=bE[1];var bL=bJ.split(/\s*\(/);var bz=bL[0];var bD=bL[1].match(/\s*(.*?)\s*\)/);var bB=bD[1].split(/[, ]+/);var bG="abcdef".split("");var bA=I.createSVGMatrix();$.each(bB,function(bN,bO){bB[bN]=parseFloat(bO);if(bz=="matrix"){bA[bG[bN]]=bB[bN]}});var bH=I.createSVGTransform();var bC="set"+bz.charAt(0).toUpperCase()+bz.slice(1);var bK=bz=="matrix"?[bA]:bB;if(bz=="scale"&&bK.length==1){bK.push(bK[0])}else{if(bz=="translate"&&bK.length==1){bK.push(0)}}bH[bC].apply(bH,bK);this._list.appendItem(bH)}}};this.numberOfItems=0;this.clear=function(){this.numberOfItems=0;this._xforms=[]};this.initialize=function(bz){this.numberOfItems=1;this._xforms=[bz]};this.getItem=function(bz){if(bz<this.numberOfItems&&bz>=0){return this._xforms[bz]}return null};this.insertItemBefore=function(bC,bA){var bE=null;if(bA>=0){if(bA<this.numberOfItems){var bD=new Array(this.numberOfItems+1);for(var bB=0;bB<bA;++bB){bD[bB]=this._xforms[bB]}bD[bB]=bC;for(var bz=bB+1;bB<this.numberOfItems;++bz,++bB){bD[bz]=this._xforms[bB]}this.numberOfItems++;this._xforms=bD;bE=bC;this._list._update()}else{bE=this._list.appendItem(bC)}}return bE};this.replaceItem=function(bA,bz){var bB=null;if(bz<this.numberOfItems&&bz>=0){this._xforms[bz]=bA;bB=bA;this._list._update()}return bB};this.removeItem=function(bA){var bD=null;if(bA<this.numberOfItems&&bA>=0){var bD=this._xforms[bA];var bC=new Array(this.numberOfItems-1);for(var bB=0;bB<bA;++bB){bC[bB]=this._xforms[bB]}for(var bz=bB;bz<this.numberOfItems-1;++bz,++bB){bC[bz]=this._xforms[bB+1]}this.numberOfItems--;this._xforms=bC;this._list._update()}return bD};this.appendItem=function(bz){this._xforms.push(bz);this.numberOfItems++;this._list._update();return bz}};function aB(bz,bx){if(bz&&bz.nodeType==1){bx(bz);var by=bz.childNodes.length;while(by--){aB(bz.childNodes.item(by),bx)}}}function bq(bz,bx){if(bz&&bz.nodeType==1){var by=bz.childNodes.length;while(by--){aB(bz.childNodes.item(by),bx)}bx(bz)}}var aH=this.assignAttributes=function(bC,bz,by,bx){if(!by){by=0}var bD=null;if(!window.opera){I.suspendRedraw(by)}for(var bA in bz){var bB=(bA.substr(0,4)=="xml:"?Y:bA.substr(0,6)=="xlink:"?aM:null);if(bB||!bx){bC.setAttributeNS(bB,bA,bz[bA])}else{ad(bC,bA,bz[bA])}}if(!window.opera){I.unsuspendRedraw(bD)}};var aA=this.cleanupElement=function(by){var bz=I.suspendRedraw(60);var bA={"fill-opacity":1,"stop-opacity":1,opacity:1,stroke:"none","stroke-dasharray":"none","stroke-linejoin":"miter","stroke-linecap":"butt","stroke-opacity":1,"stroke-width":1,rx:0,ry:0};for(var bx in bA){var bB=bA[bx];if(by.getAttribute(bx)==bB){by.removeAttribute(bx)}}I.unsuspendRedraw(bz)};var c=this.addSvgElementFromJson=function(by){var bx=b(by.attr.id);if(bx&&by.element!=bx.tagName){X.removeChild(bx);bx=null}if(!bx){bx=aV.createElementNS(aT,by.element);if(X){(ao||X).appendChild(bx)}}if(by.curStyles){aH(bx,{fill:aW.fill,stroke:aW.stroke,"stroke-width":aW.stroke_width,"stroke-dasharray":aW.stroke_dasharray,"stroke-linejoin":aW.stroke_linejoin,"stroke-linecap":aW.stroke_linecap,"stroke-opacity":aW.stroke_opacity,"fill-opacity":aW.fill_opacity,opacity:aW.opacity/2,style:"pointer-events:inherit"},100)}aH(bx,by.attr,100);aA(bx);return bx};(function(){var bx=aV.createComment(" Created with SVG-edit - http://svg-edit.googlecode.com/ ");am.appendChild(bx)})();var a6=[],bb={},ag=L.imgPath+"logo.png",X=null,ao=null,ae=[],al={round_digits:5},aP=false,bl=1,ap=null,bh="select",ac="none",W={shape:{fill:"#"+L.initFill.color,fill_paint:null,fill_opacity:L.initFill.opacity,stroke:"#"+L.initStroke.color,stroke_paint:null,stroke_opacity:L.initStroke.opacity,stroke_width:L.initStroke.width,stroke_dasharray:"none",stroke_linejoin:"miter",stroke_linecap:"butt",opacity:L.initOpacity}};W.text=$.extend(true,{},W.shape);$.extend(W.text,{fill:"#000000",stroke_width:0,font_size:24,font_family:"serif"});var aW=W.shape,bn=W.text,t=aW,af=1,a3=new Array(1),w=new Array(1),M=null,H=this.selectorManager=new bu(),j=null,aQ=[],e={},ak=null;bt.clipBoard=[];var aR=this.runExtensions=function(by,bA,bz){var bx=false;if(bz){bx=[]}$.each(e,function(bB,bC){if(by in bC){if(bz){bx.push(bC[by](bA))}else{bx=bC[by](bA)}}});return bx};this.addExtension=function(bx,bz){if(!(bx in e)){if($.isFunction(bz)){var by=bz($.extend(bt.getPrivateMethods(),{svgroot:I,svgcontent:am,nonce:m,selectorManager:H}))}else{var by=bz}e[bx]=by;call("extension_added",by)}else{console.log('Cannot add extension "'+bx+'", an extension by that name already exists"')}};var bj=function(by){var bx=al.round_digits;if(!isNaN(by)){return Number(Number(by).toFixed(bx))}else{if($.isArray(by)){return bj(by[0])+","+bj(by[1])}}};var S=this.round=function(bx){return parseInt(bx*af)/af};var ba=this.getIntersectionList=function(bB){if(j==null){return null}var bA=ao||X;if(!aQ.length){aQ=aY(bA,true)}var bx=null;try{bx=bA.getIntersectionList(bB,null)}catch(bC){}if(bx==null||typeof(bx.item)!="function"){bx=[];if(!bB){var bz=j.getBBox();var bE={};for(var bD in bz){bE[bD]=bz[bD]/af}bz=bE}else{var bz=bB}var by=aQ.length;while(by--){if(!bz.width||!bz.width){continue}if(aE.rectsIntersect(bz,aQ[by].bbox)){bx.push(aQ[by].elem)}}}return bx};var aj=this.getStrokedBBox=function(by){if(!by){by=aY()}if(!by.length){return false}var bz=function(bI){try{var bN=aC(bI);var bJ=az(bI);if((bJ&&bJ%90)||aZ(a0(bI))){var bM=false;var bP=["ellipse","path","line","polyline","polygon"];if($.inArray(bI.tagName,bP)!=-1){bN=bM=bt.convertToPath(bI,true)}else{if(bI.tagName=="rect"){var bH=bI.getAttribute("rx");var bG=bI.getAttribute("ry");if(bH||bG){bN=bM=bt.convertToPath(bI,true)}}}if(!bM){var bK=document.createElementNS(aT,"g");var bO=bI.parentNode;bO.replaceChild(bK,bI);bK.appendChild(bI);bN=bK.getBBox();bO.insertBefore(bI,bK);bO.removeChild(bK)}}return bN}catch(bL){console.log(bI,bL);return null}};var bD;$.each(by,function(){if(bD){return}if(!this.parentNode){return}bD=bz(this);if(bD){var bG={};for(var bH in bD){bG[bH]=bD[bH]}bD=bG}});if(bD==null){return null}var bx=bD.x+bD.width;var bF=bD.y+bD.height;var bC=bD.x;var bB=bD.y;var bE=function(bH){var bG=bH.getAttribute("stroke-width");var bI=0;if(bH.getAttribute("stroke")!="none"&&!isNaN(bG)){bI+=bG/2}return bI};var bA=[];$.each(by,function(bH,bI){var bG=bz(bI);if(bG){var bJ=bE(bI);bC=Math.min(bC,bG.x-bJ);bB=Math.min(bB,bG.y-bJ);bA.push(bG)}});bD.x=bC;bD.y=bB;$.each(by,function(bH,bI){var bG=bA[bH];if(bG&&bI.nodeType==1){var bJ=bE(bI);bx=Math.max(bx,bG.x+bG.width+bJ);bF=Math.max(bF,bG.y+bG.height+bJ)}});bD.width=bx-bC;bD.height=bF-bB;return bD};var aY=this.getVisibleElements=function(bx,by){if(!bx){bx=$(am).children()}var bz=[];$(bx).children().each(function(bA,bD){try{var bC=bD.getBBox();if(bC){var bB=by?{elem:bD,bbox:aj([bD])}:bD;bz.push(bB)}}catch(bE){}});return bz.reverse()};var s=this.groupSvgElem=function(by){var bx=document.createElementNS(aT,"g");by.parentNode.replaceChild(bx,by);$(bx).append(by).data("gsvg",by)[0].id=bo()};var ay=function(by){var bA=document.createElementNS(by.namespaceURI,by.nodeName);$.each(by.attributes,function(bC,bB){if(bB.localName!="-moz-math-font-style"){bA.setAttributeNS(bB.namespaceURI,bB.nodeName,bB.nodeValue)}});bA.removeAttribute("id");bA.id=bo();bl++;if((aK)&&by.nodeName=="path"){var bx=B.convertPath(by);bA.setAttribute("d",bx)}$.each(by.childNodes,function(bB,bC){switch(bC.nodeType){case 1:bA.appendChild(ay(bC));break;case 3:bA.textContent=bC.nodeValue;break;default:break}});if($(by).data("gsvg")){$(bA).data("gsvg",bA.firstChild)}else{if($(by).data("symbol")){var bz=$(by).data("symbol");$(bA).data("ref",bz).data("symbol",bz)}else{if(bA.tagName=="image"){a9(bA)}}}return bA};function b(bx){if(I.querySelector){return I.querySelector("#"+bx)}else{if(aV.evaluate){return aV.evaluate('svg:svg[@id="svgroot"]//svg:*[@id="'+bx+'"]',aU,function(){return"http://www.w3.org/2000/svg"},9,null).singleNodeValue}else{return $(I).find("[id="+bx+"]")[0]}}}var E,bo;(function(bz){var bx={};var by="svg_";E=bz.getId=function(){if(bx.getid){return call("getid",bl)}if(q){return by+m+"_"+bl}else{return by+bl}};bo=bz.getNextId=function(){var bA=E();while(b(bA)){bl++;bA=E()}return bA};call=bz.call=function(bB,bA){if(bx[bB]){return bx[bB](this,bA)}};bz.bind=function(bB,bC){var bA=bx[bB];bx[bB]=bC;return bA};bz.setIdPrefix=function(bA){by=bA}}(bt));var O=this.sanitizeSvg=function(bC){if(bC.nodeType==3){bC.nodeValue=bC.nodeValue.replace(/^\s+|\s+$/g,"");if(!bC.nodeValue.length){bC.parentNode.removeChild(bC)}}if(bC.nodeType!=1){return}var bK=bC.ownerDocument;var bL=bC.parentNode;if(!bK||!bL){return}var bH=aO[bC.nodeName];var bB=h[bC.nodeName];if(bH!=undefined){var bA=[];var bD=bC.attributes.length;while(bD--){var bG=bC.attributes.item(bD);var bJ=bG.nodeName;var bE=bG.localName;var bM=bG.namespaceURI;if(!(bB.hasOwnProperty(bE)&&bM==bB[bE]&&bM!=bw)&&!(bM==bw&&au[bG.nodeValue])){if(bJ.indexOf("se:")==0){bA.push([bJ,bG.nodeValue])}bC.removeAttributeNS(bM,bE)}if(bC.nodeName=="path"&&bJ=="d"){bC.setAttribute("d",B.convertPath(bC));B.fixEnd(bC)}if(bJ=="style"){var bI=bG.nodeValue.split(";"),by=bI.length;while(by--){var bF=bI[by].split(":");if(bH.indexOf(bF[0])!=-1){bC.setAttribute(bF[0],bF[1])}}bC.removeAttribute("style")}}$.each(bA,function(bO,bN){bC.setAttributeNS(at,bN[0],bN[1])});var bx=bk(bC);if(bx&&$.inArray(bC.nodeName,["filter","linearGradient","pattern","radialGradient","textPath","use"])!=-1){if(bx[0]!="#"){a2(bC,"");bC.removeAttributeNS(aM,"href")}}if(bC.nodeName=="use"&&!bk(bC)){bL.removeChild(bC);return}$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(bO,bN){var bP=bC.getAttribute(bN);if(bP){bP=ar(bP);if(bP&&bP[0]!="#"){bC.setAttribute(bN,"");bC.removeAttribute(bN)}}});bD=bC.childNodes.length;while(bD--){O(bC.childNodes.item(bD))}}else{var bz=[];while(bC.hasChildNodes()){bz.push(bL.insertBefore(bC.firstChild,bC))}bL.removeChild(bC);var bD=bz.length;while(bD--){O(bz[bD])}}};var ar=this.getUrlFromAttr=function(bx){if(bx){if(bx.indexOf('url("')==0){return bx.substring(5,bx.indexOf('"',6))}else{if(bx.indexOf("url('")==0){return bx.substring(5,bx.indexOf("'",6))}else{if(bx.indexOf("url(")==0){return bx.substring(4,bx.indexOf(")"))}}}}return null};var aC=this.getBBox=function(bB){var bA=bB||a3[0];if(bB.nodeType!=1){return null}var by=null;var bx=bA.nodeName;if(bx==="text"&&bA.textContent===""){bA.textContent="a";by=bA.getBBox();bA.textContent=""}else{if(bx==="path"&&aK){by=bs(bA)}else{if(bx==="use"&&!aK||bx==="foreignObject"){by=bA.getBBox();var bD={};bD.width=by.width;bD.height=by.height;bD.x=by.x+parseFloat(bA.getAttribute("x")||0);bD.y=by.y+parseFloat(bA.getAttribute("y")||0);by=bD}else{if(~$.inArray(bx,bd)){try{by=bA.getBBox()}catch(bC){var bz=$(bA).closest("foreignObject");if(bz.length){try{by=bz[0].getBBox()}catch(bC){by=null}}else{by=null}}}}}}return by};var g=function(bx){if(navigator.userAgent.indexOf("Gecko/")==-1){return bx}var by=bx.cloneNode(true);bx.parentNode.insertBefore(by,bx);bx.parentNode.removeChild(bx);H.releaseSelector(bx);a3[0]=by;H.requestSelector(by).showGrips(true);return by};var bs=function(bM){var bR=bM.pathSegList;var bK=bR.numberOfItems;var bE=[[],[]];var bD=bR.getItem(0);var bC=[bD.x,bD.y];for(var bO=0;bO<bK;bO++){var bQ=bR.getItem(bO);if(!bQ.x){continue}bE[0].push(bC[0]);bE[1].push(bC[1]);if(bQ.x1){var bB=[bQ.x1,bQ.y1],bA=[bQ.x2,bQ.y2],by=[bQ.x,bQ.y];for(var bN=0;bN<2;bN++){var bx=function(bV){return Math.pow(1-bV,3)*bC[bN]+3*Math.pow(1-bV,2)*bV*bB[bN]+3*(1-bV)*Math.pow(bV,2)*bA[bN]+Math.pow(bV,3)*by[bN]};var bT=6*bC[bN]-12*bB[bN]+6*bA[bN];var bU=-3*bC[bN]+9*bB[bN]-9*bA[bN]+3*by[bN];var bS=3*bB[bN]-3*bC[bN];if(bU==0){if(bT==0){continue}var bL=-bS/bT;if(0<bL&&bL<1){bE[bN].push(bx(bL))}continue}var bz=Math.pow(bT,2)-4*bS*bU;if(bz<0){continue}var bI=(-bT+Math.sqrt(bz))/(2*bU);if(0<bI&&bI<1){bE[bN].push(bx(bI))}var bG=(-bT-Math.sqrt(bz))/(2*bU);if(0<bG&&bG<1){bE[bN].push(bx(bG))}}bC=by}else{bE[0].push(bQ.x);bE[1].push(bQ.y)}}var bH=Math.min.apply(null,bE[0]);var bJ=Math.max.apply(null,bE[0])-bH;var bF=Math.min.apply(null,bE[1]);var bP=Math.max.apply(null,bE[1])-bF;return{x:bH,y:bF,width:bJ,height:bP}};var az=this.getRotationAngle=function(bB,by){var bA=bB||a3[0];var bD=a0(bA);if(!bD){return 0}var bC=bD.numberOfItems;for(var bz=0;bz<bC;++bz){var bx=bD.getItem(bz);if(bx.type==4){return by?bx.angle*Math.PI/180:bx.angle}}return 0};this.setRotationAngle=function(bz,bH){bz=parseFloat(bz);var bA=a3[0];var bE=bA.getAttribute("transform");var bK=aC(bA);var bD=bK.x+bK.width/2,bC=bK.y+bK.height/2;var bG=a0(bA);if(bG.numberOfItems>0){var bJ=bG.getItem(0);if(bJ.type==4){bG.removeItem(0)}}if(bz!=0){var bx=R(bD,bC,u(bG).matrix);var bI=I.createSVGTransform();bI.setRotate(bz,bx.x,bx.y);if(bG.numberOfItems){bG.insertItemBefore(bI,0)}else{bG.appendItem(bI)}}else{if(bG.numberOfItems==0){bA.removeAttribute("transform")}}if(!bH){var by=bA.getAttribute("transform");bA.setAttribute("transform",bE);C("transform",by,a3)}var bF=b("pathpointgrip_container");var bB=H.requestSelector(a3[0]);bB.resize();bB.updateGripCursors(bz)};var a0=this.getTransformList=function(by){if(aK){var bz=by.id;if(!bz){bz="temp"}var bx=V[bz];if(!bx||bz=="temp"){V[bz]=new J(by);V[bz]._init();bx=V[bz]}return bx}else{if(by.transform){return by.transform.baseVal}else{if(by.gradientTransform){return by.gradientTransform.baseVal}}}return null};var bc=this.recalculateAllSelectedDimensions=function(){var bB=(ac=="none"?"position":"size");var bx=new aI(bB);var by=a3.length;while(by--){var bz=a3[by];var bA=l(bz);if(bA){bx.addSubCommand(bA)}}if(!bx.isEmpty()){a7(bx);call("changed",a3)}};var G=[0,"z","M","m","L","l","C","c","Q","q","A","a","H","h","V","v","S","s","T","t"];var aF=function(bx){console.log([bx.a,bx.b,bx.c,bx.d,bx.e,bx.f])};var F=this.remapElement=function(bM,b0,bP){var bC=function(b1,b2){return R(b1,b2,bP)},bB=function(b1){return bP.a*b1},bK=function(b1){return bP.d*b1},bH=aC(bM);switch(bM.tagName){case"line":var bF=bC(b0.x1,b0.y1),bE=bC(b0.x2,b0.y2);b0.x1=bF.x;b0.y1=bF.y;b0.x2=bE.x;b0.y2=bE.y;break;case"circle":var bY=bC(b0.cx,b0.cy);b0.cx=bY.x;b0.cy=bY.y;var bS=bv(bH.x,bH.y,bH.width,bH.height,bP);var bI=bS.tr.x-bS.tl.x,bW=bS.bl.y-bS.tl.y;b0.r=Math.min(bI/2,bW/2);break;case"ellipse":var bY=bC(b0.cx,b0.cy);b0.cx=bY.x;b0.cy=bY.y;b0.rx=bB(b0.rx);b0.ry=bK(b0.ry);break;case"foreignObject":case"rect":case"image":var bF=bC(b0.x,b0.y);b0.x=bF.x;b0.y=bF.y;b0.width=bB(b0.width);b0.height=bK(b0.height);break;case"use":case"g":case"text":if(bP.a==1&&bP.b==0&&bP.c==0&&bP.d==1&&(bP.e!=0||bP.f!=0)){var bL=u(bM).matrix,bG=ai(bL.inverse(),bP,bL);b0.x=parseFloat(b0.x)+bG.e;b0.y=parseFloat(b0.y)+bG.f}else{var by=a0(bM);var bN=I.createSVGTransform();bN.setMatrix(ai(u(by).matrix,bP));by.clear();by.appendItem(bN)}break;case"polygon":case"polyline":var bV=b0.points.length;for(var bU=0;bU<bV;++bU){var bO=b0.points[bU];bO=bC(bO.x,bO.y);b0.points[bU].x=bO.x;b0.points[bU].y=bO.y}break;case"path":var bx=bM.pathSegList;var bV=bx.numberOfItems;b0.d=new Array(bV);for(var bU=0;bU<bV;++bU){var bX=bx.getItem(bU);b0.d[bU]={type:bX.pathSegType,x:bX.x,y:bX.y,x1:bX.x1,y1:bX.y1,x2:bX.x2,y2:bX.y2,r1:bX.r1,r2:bX.r2,angle:bX.angle,largeArcFlag:bX.largeArcFlag,sweepFlag:bX.sweepFlag}}var bV=b0.d.length,bA=b0.d[0],bQ=bC(bA.x,bA.y);b0.d[0].x=bQ.x;b0.d[0].y=bQ.y;for(var bU=1;bU<bV;++bU){var bX=b0.d[bU];var bz=bX.type;if(bz%2==0){var bT=(bX.x!=undefined)?bX.x:bQ.x,bR=(bX.y!=undefined)?bX.y:bQ.y,bO=bC(bT,bR),bF=bC(bX.x1,bX.y1),bE=bC(bX.x2,bX.y2);bX.x=bO.x;bX.y=bO.y;bX.x1=bF.x;bX.y1=bF.y;bX.x2=bE.x;bX.y2=bE.y;bX.r1=bB(bX.r1),bX.r2=bK(bX.r2)}else{bX.x=bB(bX.x);bX.y=bK(bX.y);bX.x1=bB(bX.x1);bX.y1=bK(bX.y1);bX.x2=bB(bX.x2);bX.y2=bK(bX.y2);bX.r1=bB(bX.r1),bX.r2=bK(bX.r2)}if(bX.x){bQ.x=bX.x}if(bX.y){bQ.y=bX.y}}break}switch(bM.tagName){case"foreignObject":case"rect":case"image":b0.x=b0.x-0+Math.min(0,b0.width);b0.y=b0.y-0+Math.min(0,b0.height);b0.width=Math.abs(b0.width);b0.height=Math.abs(b0.height);if(L.gridSnapping&&bM.parentNode.parentNode.localName=="svg"){b0.x=aq(b0.x);b0.y=aq(b0.y);b0.width=aq(b0.width);b0.height=aq(b0.height)}aH(bM,b0,1000,true);break;case"ellipse":b0.rx=Math.abs(b0.rx);b0.ry=Math.abs(b0.ry);if(L.gridSnapping&&bM.parentNode.parentNode.localName=="svg"){b0.cx=aq(b0.cx);b0.cy=aq(b0.cy);b0.rx=aq(b0.rx);b0.ry=aq(b0.ry)}case"circle":if(b0.r){b0.r=Math.abs(b0.r)}if(L.gridSnapping&&bM.parentNode.parentNode.localName=="svg"){b0.cx=aq(b0.cx);b0.cy=aq(b0.cy);b0.r=aq(b0.r)}case"line":if(L.gridSnapping&&bM.parentNode.parentNode.localName=="svg"){b0.x1=aq(b0.x1);b0.y1=aq(b0.y1);b0.x2=aq(b0.x2);b0.y2=aq(b0.y2)}case"text":if(L.gridSnapping&&bM.parentNode.parentNode.localName=="svg"){b0.x=aq(b0.x);b0.y=aq(b0.y)}case"use":aH(bM,b0,1000,true);break;case"g":var bZ=$(bM).data("gsvg");if(bZ){aH(bZ,b0,1000,true)}break;case"polyline":case"polygon":var bV=b0.points.length;var bD="";for(var bU=0;bU<bV;++bU){var bO=b0.points[bU];bD+=bO.x+","+bO.y+" "}bM.setAttribute("points",bD);break;case"path":var bJ="";var bV=b0.d.length;for(var bU=0;bU<bV;++bU){var bX=b0.d[bU];var bz=bX.type;bJ+=G[bz];switch(bz){case 13:case 12:bJ+=bX.x+" ";break;case 15:case 14:bJ+=bX.y+" ";break;case 3:case 5:case 19:case 2:case 4:case 18:bJ+=bX.x+","+bX.y+" ";break;case 7:case 6:bJ+=bX.x1+","+bX.y1+" "+bX.x2+","+bX.y2+" "+bX.x+","+bX.y+" ";break;case 9:case 8:bJ+=bX.x1+","+bX.y1+" "+bX.x+","+bX.y+" ";break;case 11:case 10:bJ+=bX.r1+","+bX.r2+" "+bX.angle+" "+Number(bX.largeArcFlag)+" "+Number(bX.sweepFlag)+" "+bX.x+","+bX.y+" ";break;case 17:case 16:bJ+=bX.x2+","+bX.y2+" "+bX.x+","+bX.y+" ";break}}bM.setAttribute("d",bJ);break}};var an=function(by,bA,bx){var bD=ar(by).substr(1);var bB=b(bD).firstChild;var bC=a0(bB);var bz=I.createSVGTransform();bz.setTranslate(bA,bx);bC.appendItem(bz);l(bB)};var l=this.recalculateDimensions=function(b2){if(b2==null){return null}var ca=a0(b2);if(ca&&ca.numberOfItems>0){var ct=ca.numberOfItems;while(ct--){var ci=ca.getItem(ct);if(ci.type==0){ca.removeItem(ct)}else{if(ci.type==1){if(bp(ci.matrix)){ca.removeItem(ct)}}else{if(ci.type==4){if(ci.angle==0){ca.removeItem(ct)}}}}}if(ca.numberOfItems==1&&az(b2)){return null}}if(!ca||ca.numberOfItems==0){b2.removeAttribute("transform");return null}var bR=$(b2).data("gsvg");var by=new aI("Transform");var bW={},cB=null,bH=[];switch(b2.tagName){case"line":bH=["x1","y1","x2","y2"];break;case"circle":bH=["cx","cy","r"];break;case"ellipse":bH=["cx","cy","rx","ry"];break;case"foreignObject":case"rect":case"image":bH=["width","height","x","y"];break;case"use":case"text":bH=["x","y"];break;case"polygon":case"polyline":cB={};cB.points=b2.getAttribute("points");var bV=b2.points;var bT=bV.numberOfItems;bW.points=new Array(bT);for(var cw=0;cw<bT;++cw){var bI=bV.getItem(cw);bW.points[cw]={x:bI.x,y:bI.y}}break;case"path":cB={};cB.d=b2.getAttribute("d");bW.d=b2.getAttribute("d");break}if(bH.length){bW=$(b2).attr(bH);$.each(bW,function(cG,cH){bW[cG]=bi(cG,cH)})}else{if(bR){bW={x:$(bR).attr("x")||0,y:$(bR).attr("y")||0}}}if(cB==null){cB=$.extend(true,{},bW);$.each(cB,function(cG,cH){cB[cG]=bi(cG,cH)})}cB.transform=ap?ap:"";if((b2.tagName=="g"&&!bR)||b2.tagName=="a"){var bD=aC(b2),cE={x:bD.x+bD.width/2,y:bD.y+bD.height/2},bA=R(bD.x+bD.width/2,bD.y+bD.height/2,u(ca).matrix),cn=I.createSVGMatrix();var b0=az(b2);if(b0){var cC=b0*Math.PI/180;if(Math.abs(cC)>(1e-10)){var cf=Math.sin(cC)/(1-Math.cos(cC))}else{var cf=2/cC}for(var cw=0;cw<ca.numberOfItems;++cw){var ci=ca.getItem(cw);if(ci.type==4){var b8=ci.matrix;cE.y=(cf*b8.e+b8.f)/2;cE.x=(b8.e-cf*b8.f)/2;ca.removeItem(cw);break}}}var cu=0,cs=0,b9=0,bF=ca.numberOfItems;if(bF){var cr=ca.getItem(0).matrix}if(bF>=3&&ca.getItem(bF-2).type==3&&ca.getItem(bF-3).type==2&&ca.getItem(bF-1).type==2){b9=3;var cF=ca.getItem(bF-3).matrix,bL=ca.getItem(bF-2).matrix,cl=ca.getItem(bF-1).matrix;var bP=b2.childNodes;var cA=bP.length;while(cA--){var bC=bP.item(cA);cu=0;cs=0;if(bC.nodeType==1){var bU=a0(bC);if(!bU){continue}var cn=u(bU).matrix;var bS=az(bC);var ce=ap;var co=[];ap=bC.getAttribute("transform");if(bS||aZ(bU)){var cd=I.createSVGTransform();cd.setMatrix(ai(cF,bL,cl,cn));bU.clear();bU.appendItem(cd);co.push(cd)}else{var bB=ai(cn.inverse(),cl,cn);var b4=I.createSVGMatrix();b4.e=-bB.e;b4.f=-bB.f;var cz=ai(b4.inverse(),cn.inverse(),cF,bL,cl,cn,bB.inverse());var cD=I.createSVGTransform(),b6=I.createSVGTransform(),bK=I.createSVGTransform();cD.setTranslate(bB.e,bB.f);b6.setScale(cz.a,cz.d);bK.setTranslate(b4.e,b4.f);bU.appendItem(bK);bU.appendItem(b6);bU.appendItem(cD);co.push(bK);co.push(b6);co.push(cD);aF(bK.matrix);aF(b6.matrix)}by.addSubCommand(l(bC));ap=ce}}ca.removeItem(bF-1);ca.removeItem(bF-2);ca.removeItem(bF-3)}else{if(bF>=3&&ca.getItem(bF-1).type==1){b9=3;cn=u(ca).matrix;var cd=I.createSVGTransform();cd.setMatrix(cn);ca.clear();ca.appendItem(cd)}else{if((bF==1||(bF>1&&ca.getItem(1).type!=3))&&ca.getItem(0).type==2){b9=2;var bZ=u(ca).matrix;ca.removeItem(0);var b5=u(ca).matrix.inverse();var bO=ai(b5,bZ);cu=bO.e;cs=bO.f;if(cu!=0||cs!=0){var bP=b2.childNodes;var cA=bP.length;var bJ=[];while(cA--){var bC=bP.item(cA);if(bC.nodeType==1){if(bC.getAttribute("clip-path")){var bN=bC.getAttribute("clip-path");if($.inArray(bN,bJ)===-1){an(bN,cu,cs);bJ.push(bN)}}var ce=ap;ap=bC.getAttribute("transform");var bU=a0(bC);if(bU){var b3=I.createSVGTransform();b3.setTranslate(cu,cs);if(bU.numberOfItems){bU.insertItemBefore(b3,0)}else{bU.appendItem(b3)}by.addSubCommand(l(bC));var b1=b2.getElementsByTagNameNS(aT,"use");var bY="#"+bC.id;var cc=b1.length;while(cc--){var cb=b1.item(cc);if(bY==bk(cb)){var cx=I.createSVGTransform();cx.setTranslate(-cu,-cs);a0(cb).insertItemBefore(cx,0);by.addSubCommand(l(cb))}}ap=ce}}}bJ=[];ap=ce}}else{if(bF==1&&ca.getItem(0).type==1&&!b0){b9=1;var cn=ca.getItem(0).matrix,bP=b2.childNodes,cA=bP.length;while(cA--){var bC=bP.item(cA);if(bC.nodeType==1){var ce=ap;ap=bC.getAttribute("transform");var bU=a0(bC);if(!bU){continue}var cv=ai(cn,u(bU).matrix);var ck=I.createSVGTransform();ck.setMatrix(cv);bU.clear();bU.appendItem(ck,0);by.addSubCommand(l(bC));ap=ce}}ca.clear()}else{if(b0){var bz=I.createSVGTransform();bz.setRotate(b0,bA.x,bA.y);if(ca.numberOfItems){ca.insertItemBefore(bz,0)}else{ca.appendItem(bz)}}if(ca.numberOfItems==0){b2.removeAttribute("transform")}return null}}}}if(b9==2){if(b0){bA={x:cE.x+cr.e,y:cE.y+cr.f};var bz=I.createSVGTransform();bz.setRotate(b0,bA.x,bA.y);if(ca.numberOfItems){ca.insertItemBefore(bz,0)}else{ca.appendItem(bz)}}}else{if(b9==3){var cn=u(ca).matrix;var bx=I.createSVGTransform();bx.setRotate(b0,cE.x,cE.y);var b7=bx.matrix;var cm=I.createSVGTransform();cm.setRotate(b0,bA.x,bA.y);var bX=cm.matrix.inverse(),cq=cn.inverse(),ch=ai(cq,bX,b7,cn);cu=ch.e;cs=ch.f;if(cu!=0||cs!=0){var bP=b2.childNodes;var cA=bP.length;while(cA--){var bC=bP.item(cA);if(bC.nodeType==1){var ce=ap;ap=bC.getAttribute("transform");var bU=a0(bC);var b3=I.createSVGTransform();b3.setTranslate(cu,cs);if(bU.numberOfItems){bU.insertItemBefore(b3,0)}else{bU.appendItem(b3)}by.addSubCommand(l(bC));ap=ce}}}if(b0){if(ca.numberOfItems){ca.insertItemBefore(cm,0)}else{ca.appendItem(cm)}}}}}else{var bD=aC(b2);if(!bD&&b2.tagName!="path"){return null}var cn=I.createSVGMatrix(),bS=az(b2);if(bS){var cE={x:bD.x+bD.width/2,y:bD.y+bD.height/2},bA=R(bD.x+bD.width/2,bD.y+bD.height/2,u(ca).matrix);var cC=bS*Math.PI/180;if(Math.abs(cC)>(1e-10)){var cf=Math.sin(cC)/(1-Math.cos(cC))}else{var cf=2/cC}for(var cw=0;cw<ca.numberOfItems;++cw){var ci=ca.getItem(cw);if(ci.type==4){var b8=ci.matrix;cE.y=(cf*b8.e+b8.f)/2;cE.x=(b8.e-cf*b8.f)/2;ca.removeItem(cw);break}}}var b9=0;var bF=ca.numberOfItems;if(!aK){var bM=b2.getAttribute("fill");if(bM&&bM.indexOf("url(")===0){var bQ=b(ar(bM).substr(1));if(bQ.getAttribute("gradientUnits")==="userSpaceOnUse"){var bQ=$(bQ);cn=u(ca).matrix;var cj=a0(bQ[0]);var cp=u(cj).matrix;cn=ai(cn,cp);var cg="matrix("+[cn.a,cn.b,cn.c,cn.d,cn.e,cn.f].join(",")+")";bQ.attr("gradientTransform",cg)}}}if(bF>=3&&ca.getItem(bF-2).type==3&&ca.getItem(bF-3).type==2&&ca.getItem(bF-1).type==2){b9=3;cn=u(ca,bF-3,bF-1).matrix;ca.removeItem(bF-1);ca.removeItem(bF-2);ca.removeItem(bF-3)}else{if(bF==4&&ca.getItem(bF-1).type==1){b9=3;cn=u(ca).matrix;var cd=I.createSVGTransform();cd.setMatrix(cn);ca.clear();ca.appendItem(cd);cn=I.createSVGMatrix()}else{if((bF==1||(bF>1&&ca.getItem(1).type!=3))&&ca.getItem(0).type==2){b9=2;var cy=ca.getItem(0).matrix,bG=u(ca,1).matrix,bE=bG.inverse();cn=ai(bE,cy,bG);ca.removeItem(0)}else{if(bF==1&&ca.getItem(0).type==1&&!bS){cn=u(ca).matrix;switch(b2.tagName){case"line":bW=$(b2).attr(["x1","y1","x2","y2"]);case"polyline":case"polygon":bW.points=b2.getAttribute("points");if(bW.points){var bV=b2.points;var bT=bV.numberOfItems;bW.points=new Array(bT);for(var cw=0;cw<bT;++cw){var bI=bV.getItem(cw);bW.points[cw]={x:bI.x,y:bI.y}}}case"path":bW.d=b2.getAttribute("d");b9=1;ca.clear();break;default:break}}else{b9=4;if(bS){var bz=I.createSVGTransform();bz.setRotate(bS,bA.x,bA.y);if(ca.numberOfItems){ca.insertItemBefore(bz,0)}else{ca.appendItem(bz)}}if(ca.numberOfItems==0){b2.removeAttribute("transform")}return null}}}}if(b9==1||b9==2||b9==3){F(b2,bW,cn)}if(b9==2){if(bS){if(!aZ(ca)){bA={x:cE.x+cn.e,y:cE.y+cn.f}}var bz=I.createSVGTransform();bz.setRotate(bS,bA.x,bA.y);if(ca.numberOfItems){ca.insertItemBefore(bz,0)}else{ca.appendItem(bz)}}}else{if(b9==3&&bS){var cn=u(ca).matrix;var bx=I.createSVGTransform();bx.setRotate(bS,cE.x,cE.y);var b7=bx.matrix;var cm=I.createSVGTransform();cm.setRotate(bS,bA.x,bA.y);var bX=cm.matrix.inverse();var cq=cn.inverse();var ch=ai(cq,bX,b7,cn);F(b2,bW,ch);if(bS){if(ca.numberOfItems){ca.insertItemBefore(cm,0)}else{ca.appendItem(cm)}}}}}if(ca.numberOfItems==0){b2.removeAttribute("transform")}by.addSubCommand(new aD(b2,cB));return by};var p=null;var R=function(by,bz,bx){return{x:bx.a*by+bx.c*bz+bx.e,y:bx.b*by+bx.d*bz+bx.f}};var bp=function(bx){return(bx.a==1&&bx.b==0&&bx.c==0&&bx.d==1&&bx.e==0&&bx.f==0)};var ai=this.matrixMultiply=function(){var by=1e-14,bC=function(bF,bE){var bD=I.createSVGMatrix();bD.a=bF.a*bE.a+bF.c*bE.b;bD.b=bF.b*bE.a+bF.d*bE.b,bD.c=bF.a*bE.c+bF.c*bE.d,bD.d=bF.b*bE.c+bF.d*bE.d,bD.e=bF.a*bE.e+bF.c*bE.f+bF.e,bD.f=bF.b*bE.e+bF.d*bE.f+bF.f;return bD},bA=arguments,bB=bA.length,bx=bA[bB-1];while(bB-->1){var bz=bA[bB-1];bx=bC(bz,bx)}if(Math.abs(bx.a)<by){bx.a=0}if(Math.abs(bx.b)<by){bx.b=0}if(Math.abs(bx.c)<by){bx.c=0}if(Math.abs(bx.d)<by){bx.d=0}if(Math.abs(bx.e)<by){bx.e=0}if(Math.abs(bx.f)<by){bx.f=0}return bx};var u=this.transformListToTransform=function(bD,bC,by){if(bD==null){return I.createSVGTransformFromMatrix(I.createSVGMatrix())}var bC=bC==undefined?0:bC;var by=by==undefined?(bD.numberOfItems-1):by;bC=parseInt(bC);by=parseInt(by);if(bC>by){var bz=by;by=bC;bC=bz}var bx=I.createSVGMatrix();for(var bB=bC;bB<=by;++bB){var bA=(bB>=0&&bB<bD.numberOfItems?bD.getItem(bB).matrix:I.createSVGMatrix());bx=ai(bx,bA)}return I.createSVGTransformFromMatrix(bx)};var aZ=this.hasMatrixTransform=function(bz){if(!bz){return false}var by=bz.numberOfItems;while(by--){var bx=bz.getItem(by);if(bx.type==1&&!bp(bx.matrix)){return true}}return false};var D=function(bx){var by=a0(bx);return u(by).matrix};var bv=this.transformBox=function(bz,bJ,bG,bA,by){var bC={x:bz,y:bJ},bD={x:(bz+bG),y:bJ},bx={x:(bz+bG),y:(bJ+bA)},bB={x:bz,y:(bJ+bA)};bC=R(bC.x,bC.y,by);var bI=bC.x,bF=bC.x,bH=bC.y,bE=bC.y;bD=R(bD.x,bD.y,by);bI=Math.min(bI,bD.x);bF=Math.max(bF,bD.x);bH=Math.min(bH,bD.y);bE=Math.max(bE,bD.y);bB=R(bB.x,bB.y,by);bI=Math.min(bI,bB.x);bF=Math.max(bF,bB.x);bH=Math.min(bH,bB.y);bE=Math.max(bE,bB.y);bx=R(bx.x,bx.y,by);bI=Math.min(bI,bx.x);bF=Math.max(bF,bx.x);bH=Math.min(bH,bx.y);bE=Math.max(bE,bx.y);return{tl:bC,tr:bD,bl:bB,br:bx,aabox:{x:bI,y:bH,width:(bF-bI),height:(bE-bH)}}};var be=this.clearSelection=function(bA){if(a3[0]!=null){var bx=a3.length;for(var by=0;by<bx;++by){var bz=a3[by];if(bz==null){break}H.releaseSelector(bz);a3[by]=null}w[0]=null}if(!bA){call("selected",a3)}};var bm=this.addToSelection=function(bx,bB){if(bx.length==0){return}var by=0;while(by<a3.length){if(a3[by]==null){break}++by}var bz=bx.length;while(bz--){var bA=bx[bz];if(!bA||!aC(bA)){continue}if(a3.indexOf(bA)==-1){a3[by]=bA;if(by==0){w[by]=aC(bA)}by++;var bC=H.requestSelector(bA);if(a3.length>1){bC.showGrips(false)}}}if(a3[0]&&a3.length===1&&a3[0].tagName=="a"){a3[0]=a3[0].firstChild}call("selected",a3);if(bB||a3.length==1){H.requestSelector(a3[0]).showGrips(true)}else{H.requestSelector(a3[0]).showGrips(false)}a3.sort(function(bE,bD){if(bE&&bD&&bE.compareDocumentPosition){return 3-(bD.compareDocumentPosition(bE)&6)}else{if(bE==null){return 1}}});while(a3[0]==null){a3.shift(0)}};var ax=this.selectOnly=function(bx,by){be(true);bm(bx,by)};var aw=this.removeFromSelection=function(by){if(a3[0]==null){return}if(by.length==0){return}var bB=new Array(a3.length),bD=new Array(w.length),bz=0,bx=a3.length;for(var bA=0;bA<bx;++bA){var bC=a3[bA];if(bC){if(by.indexOf(bC)==-1){bB[bz]=bC;if(bz==0){bD[bz]=w[bA]}bz++}else{H.releaseSelector(bC)}}}a3=bB;w=bD};this.selectAllInCurrentLayer=function(){if(X){bh="select";ax($(ao||X).children())}};var Z=this.smoothControlPoints=function(bx,bN,bM){var bz=bx.x-bM.x,bL=bx.y-bM.y,by=bN.x-bM.x,bJ=bN.y-bM.y;if((bz!=0||bL!=0)&&(by!=0||bJ!=0)){var bF=Math.atan2(bL,bz),bE=Math.atan2(bJ,by),bB=Math.sqrt(bz*bz+bL*bL),bA=Math.sqrt(by*by+bJ*bJ),bD=I.createSVGPoint(),bC=I.createSVGPoint();if(bF<0){bF+=2*Math.PI}if(bE<0){bE+=2*Math.PI}var bK=Math.abs(bF-bE),bH=Math.abs(Math.PI-bK)/2;var bI,bG;if(bF-bE>0){bI=bK<Math.PI?(bF+bH):(bF-bH);bG=bK<Math.PI?(bE-bH):(bE+bH)}else{bI=bK<Math.PI?(bF-bH):(bF+bH);bG=bK<Math.PI?(bE+bH):(bE-bH)}bD.x=bB*Math.cos(bI)+bM.x;bD.y=bB*Math.sin(bI)+bM.y;bC.x=bA*Math.cos(bG)+bM.x;bC.y=bA*Math.sin(bG)+bM.y;return[bD,bC]}return undefined};var ab=this.getMouseTarget=function(by){if(by==null){return null}var bz=by.target;if(bz.correspondingUseElement){bz=bz.correspondingUseElement}if($.inArray(bz.namespaceURI,[f,Q])!=-1&&bz.id!="svgcanvas"){while(bz.nodeName!="foreignObject"){bz=bz.parentNode;if(!bz){return I}}}if($.inArray(bz,[I,aU,am,X])!==-1){return I}var bx=$(bz);if(bx.closest("#selectorParentGroup").length){return H.selectorParentGroup}while(bz.parentNode!==(ao||X)){bz=bz.parentNode}return bz;return bz};(function(){var bG,bF;var bx=null,bK=null,bI=null,bz=null,by=null,bH={},bA={minx:null,miny:null,maxx:null,maxy:null};var bD=function(bX){if(bt.spaceKey){return}var bY=bX.button===2;p=am.getScreenCTM().inverse();var bZ=R(bX.pageX,bX.pageY,p),bN=bZ.x*af,bL=bZ.y*af;if($.browser.msie){var b5=$(aU.parentNode).offset();bG=am.getAttribute("x")-0+b5.left-aU.parentNode.scrollLeft;bF=am.getAttribute("y")-0+b5.top-aU.parentNode.scrollTop;bN=-(bG-bX.pageX);bL=-(bF-bX.pageY)}bX.preventDefault();if(bY){bh="select";ak=bZ}var bW=bN/af,bU=bL/af,b6=ab(bX);var bS=bz=bK=bW;var bQ=by=bI=bU;if(L.gridSnapping){bW=aq(bW);bU=aq(bU);bK=aq(bK);bI=aq(bI)}if(b6==H.selectorParentGroup&&a3[0]!=null){var b0=bX.target;var bO=a1(b0,"type");if(bO=="rotate"){bh="rotate"}else{if(bO=="resize"){bh="resize";ac=a1(b0,"dir")}}b6=a3[0]}ap=b6.getAttribute("transform");var bV=a0(b6);switch(bh){case"select":aP=true;ac="none";if(bY){aP=false}if(b6!=I){if(a3.indexOf(b6)==-1){if(!bX.shiftKey){be(true)}bm([b6]);M=b6;B.clear()}if(!bY){for(var b1=0;b1<a3.length;++b1){if(a3[b1]==null){continue}var b3=a0(a3[b1]);if(b3.numberOfItems){b3.insertItemBefore(I.createSVGTransform(),0)}else{b3.appendItem(I.createSVGTransform())}}}}else{if(!bY){be();bh="multiselect";if(j==null){j=H.getRubberBandBox()}bz*=af;by*=af;aH(j,{x:bz,y:by,width:0,height:0,display:"inline"},100)}}break;case"zoom":aP=true;if(j==null){j=H.getRubberBandBox()}aH(j,{x:bS*af,y:bS*af,width:0,height:0,display:"inline"},100);break;case"resize":aP=true;bK=bW;bI=bU;bH=aC($("#selectedBox0")[0]);var bP={};$.each(bH,function(b7,b8){bP[b7]=b8/af});bH=bP;var bR=az(b6)?1:0;if(aZ(bV)){bV.insertItemBefore(I.createSVGTransform(),bR);bV.insertItemBefore(I.createSVGTransform(),bR);bV.insertItemBefore(I.createSVGTransform(),bR)}else{bV.appendItem(I.createSVGTransform());bV.appendItem(I.createSVGTransform());bV.appendItem(I.createSVGTransform())}break;case"fhellipse":case"fhrect":case"fhpath":aP=true;bx=bS+","+bQ+" ";var bM=aW.stroke_width==0?1:aW.stroke_width;c({element:"polyline",curStyles:true,attr:{points:bx,id:bo(),fill:"none",opacity:aW.opacity/2,"stroke-linecap":"round",style:"pointer-events:none"}});bA.minx=bS;bA.maxx=bS;bA.miny=bQ;bA.maxy=bQ;break;case"image":aP=true;var bT=c({element:"image",attr:{x:bW,y:bU,width:0,height:0,id:bo(),opacity:aW.opacity/2,style:"pointer-events:inherit"}});a2(bT,ag);a9(bT);break;case"square":case"rect":aP=true;bK=bW;bI=bU;c({element:"rect",curStyles:true,attr:{x:bW,y:bU,width:0,height:0,id:bo(),opacity:aW.opacity/2}});break;case"line":aP=true;var bM=aW.stroke_width==0?1:aW.stroke_width;c({element:"line",curStyles:true,attr:{x1:bW,y1:bU,x2:bW,y2:bU,id:bo(),stroke:aW.stroke,"stroke-width":bM,"stroke-dasharray":aW.stroke_dasharray,"stroke-linejoin":aW.stroke_linejoin,"stroke-linecap":aW.stroke_linecap,"stroke-opacity":aW.stroke_opacity,fill:"none",opacity:aW.opacity/2,style:"pointer-events:none"}});break;case"circle":aP=true;c({element:"circle",curStyles:true,attr:{cx:bW,cy:bU,r:0,id:bo(),opacity:aW.opacity/2}});break;case"ellipse":aP=true;c({element:"ellipse",curStyles:true,attr:{cx:bW,cy:bU,rx:0,ry:0,id:bo(),opacity:aW.opacity/2}});break;case"text":aP=true;var b4=c({element:"text",curStyles:true,attr:{x:bW,y:bU,id:bo(),fill:bn.fill,"stroke-width":bn.stroke_width,"font-size":bn.font_size,"font-family":bn.font_family,"text-anchor":"middle","xml:space":"preserve"}});break;case"path":case"pathedit":bK*=af;bI*=af;B.mouseDown(bX,b6,bK,bI);aP=true;break;case"textedit":bK*=af;bI*=af;N.mouseDown(bX,b6,bK,bI);aP=true;break;case"rotate":aP=true;bt.beginUndoableChange("transform",a3);break;default:break}var b2=aR("mouseDown",{event:bX,start_x:bK,start_y:bI,selectedElements:a3},true);$.each(b2,function(b7,b8){if(b8&&b8.started){aP=true}})};var bJ=function(ci){if(!aP){return}if(ci.button===1||bt.spaceKey){return}var cg=a3[0],bY=R(ci.pageX,ci.pageY,p),cp=bY.x*af,co=bY.y*af,ca=b(E());if($.browser.msie){cp=-(bG-ci.pageX);co=-(bF-ci.pageY)}var b0=x=cp/af;var bZ=y=co/af;if(L.gridSnapping){x=aq(x);y=aq(y)}ci.preventDefault();switch(bh){case"select":if(a3[0]!=null){var bQ=x-bK;var bP=y-bI;if(L.gridSnapping){bQ=aq(bQ);bP=aq(bP)}if(ci.shiftKey){var cj=aE.snapToAngle(bK,bI,x,y);x=cj.x;y=cj.y}if(bQ!=0||bP!=0){var b8=a3.length;for(var cw=0;cw<b8;++cw){var cg=a3[cw];if(cg==null){break}if(cw==0){var bU=aC(cg)}var cr=I.createSVGTransform();var cm=a0(cg);cr.setTranslate(bQ,bP);if(cm.numberOfItems){cm.replaceItem(cr,0)}else{cm.appendItem(cr)}H.requestSelector(cg).resize()}}}break;case"multiselect":b0*=af;bZ*=af;aH(j,{x:Math.min(bz,b0),y:Math.min(by,bZ),width:Math.abs(b0-bz),height:Math.abs(bZ-by)},100);var ch=[],cv=[],bR=ba(),b8=a3.length;for(var cw=0;cw<b8;++cw){var cz=bR.indexOf(a3[cw]);if(cz==-1){ch.push(a3[cw])}else{bR[cz]=null}}b8=bR.length;for(cw=0;cw<b8;++cw){if(bR[cw]){cv.push(bR[cw])}}if(ch.length>0){bt.removeFromSelection(ch)}if(cv.length>0){bm(cv)}break;case"resize":var cm=a0(cg),b1=aZ(cm),bU=b1?bH:aC(cg),bS=bU.x,bT=bU.y,bL=bU.width,bN=bU.height,bQ=(x-bK),bP=(y-bI);if(L.gridSnapping){bQ=aq(bQ);bP=aq(bP);bN=aq(bN);bL=aq(bL)}var b7=az(cg);if(b7){var cq=Math.sqrt(bQ*bQ+bP*bP),b9=Math.atan2(bP,bQ)-b7*Math.PI/180;bQ=cq*Math.cos(b9);bP=cq*Math.sin(b9)}if(ac.indexOf("n")==-1&&ac.indexOf("s")==-1){bP=0}if(ac.indexOf("e")==-1&&ac.indexOf("w")==-1){bQ=0}var cB=null,cu=0,ct=0,bW=bN?(bN+bP)/bN:1,bX=bL?(bL+bQ)/bL:1;if(ac.indexOf("n")!=-1){bW=bN?(bN-bP)/bN:1;ct=bN}if(ac.indexOf("w")!=-1){bX=bL?(bL-bQ)/bL:1;cu=bL}var cG=I.createSVGTransform(),ck=I.createSVGTransform(),b2=I.createSVGTransform();if(L.gridSnapping){bS=aq(bS);cu=aq(cu);bT=aq(bT);ct=aq(ct)}cG.setTranslate(-(bS+cu),-(bT+ct));if(ci.shiftKey){if(bX==1){bX=bW}else{bW=bX}}ck.setScale(bX,bW);b2.setTranslate(bS+cu,bT+ct);if(b1){var cf=b7?1:0;cm.replaceItem(cG,2+cf);cm.replaceItem(ck,1+cf);cm.replaceItem(b2,0+cf)}else{var bV=cm.numberOfItems;cm.replaceItem(b2,bV-3);cm.replaceItem(ck,bV-2);cm.replaceItem(cG,bV-1)}H.requestSelector(cg).resize();break;case"zoom":b0*=af;bZ*=af;aH(j,{x:Math.min(bz*af,b0),y:Math.min(by*af,bZ),width:Math.abs(b0-bz*af),height:Math.abs(bZ-by*af)},100);break;case"text":aH(ca,{x:x,y:y},1000);break;case"line":var cb=null;if(!window.opera){I.suspendRedraw(1000)}if(L.gridSnapping){x=aq(x);y=aq(y)}var b5=x;var cE=y;if(ci.shiftKey){var cj=aE.snapToAngle(bK,bI,b5,cE);b5=cj.x;cE=cj.y}ca.setAttributeNS(null,"x2",b5);ca.setAttributeNS(null,"y2",cE);if(!window.opera){I.unsuspendRedraw(cb)}break;case"foreignObject":case"square":case"rect":case"image":var cD=(bh=="square")||ci.shiftKey,cn=Math.abs(x-bK),cA=Math.abs(y-bI),b4,b3;if(cD){cn=cA=Math.max(cn,cA);b4=bK<x?bK:bK-cn;b3=bI<y?bI:bI-cA}else{b4=Math.min(bK,x);b3=Math.min(bI,y)}if(L.gridSnapping){cn=aq(cn);cA=aq(cA);b4=aq(b4);b3=aq(b3)}aH(ca,{width:cn,height:cA,x:b4,y:b3},1000);break;case"circle":var cC=$(ca).attr(["cx","cy"]);var cd=cC.cx,cc=cC.cy,bO=Math.sqrt((x-cd)*(x-cd)+(y-cc)*(y-cc));if(L.gridSnapping){bO=aq(bO)}ca.setAttributeNS(null,"r",bO);break;case"ellipse":var cC=$(ca).attr(["cx","cy"]);var cd=cC.cx,cc=cC.cy;cb=null;if(!window.opera){I.suspendRedraw(1000)}if(L.gridSnapping){x=aq(x);cd=aq(cd);y=aq(y);cc=aq(cc)}ca.setAttributeNS(null,"rx",Math.abs(x-cd));var ce=Math.abs(ci.shiftKey?(x-cd):(y-cc));ca.setAttributeNS(null,"ry",ce);if(!window.opera){I.unsuspendRedraw(cb)}break;case"fhellipse":case"fhrect":bA.minx=Math.min(b0,bA.minx);bA.maxx=Math.max(b0,bA.maxx);bA.miny=Math.min(bZ,bA.miny);bA.maxy=Math.max(bZ,bA.maxy);case"fhpath":bx+=+b0+","+bZ+" ";ca.setAttributeNS(null,"points",bx);break;case"path":case"pathedit":x*=af;y*=af;if(L.gridSnapping){x=aq(x);y=aq(y);bK=aq(bK);bI=aq(bI)}if(ci.shiftKey){var b6=path.dragging?path.dragging[0]:bK;var cF=path.dragging?path.dragging[1]:bI;var cj=aE.snapToAngle(b6,cF,x,y);x=cj.x;y=cj.y}if(j&&j.getAttribute("display")!="none"){aH(j,{x:Math.min(bz,b0),y:Math.min(by,bZ),width:Math.abs(b0-bz),height:Math.abs(bZ-by)},100)}B.mouseMove(x,y);break;case"textedit":x*=af;y*=af;N.mouseMove(cp,co);break;case"rotate":var bU=aC(cg),cd=bU.x+bU.width/2,cc=bU.y+bU.height/2,cs=D(cg),bM=R(cd,cc,cs);cd=bM.x;cc=bM.y;var b7=((Math.atan2(cc-y,cd-x)*(180/Math.PI))-90)%360;if(L.gridSnapping){b7=aq(b7)}if(ci.shiftKey){var cl=45;b7=Math.round(b7/cl)*cl}bt.setRotationAngle(b7<-180?(360+b7):b7,true);call("changed",a3);break;default:break}aR("mouseMove",{event:ci,mouse_x:cp,mouse_y:co,selected:cg})};var bE=function(bX){if(bX.button===2){return}var bQ=M;M=null;if(!aP){return}var b1=R(bX.pageX,bX.pageY,p),bM=b1.x*af,bL=b1.y*af,bU=bM/af,bT=bL/af,bO=b(E()),b6=false;var bS=bU;var bR=bT;aP=false;switch(bh){case"resize":case"multiselect":if(j!=null){j.setAttribute("display","none");aQ=[]}bh="select";case"select":if(a3[0]!=null){if(a3[1]==null){var bZ=a3[0];if(bZ.tagName!="g"&&bZ.tagName!="image"&&bZ.tagName!="foreignObject"){t.fill=bZ.getAttribute("fill");t.fill_opacity=bZ.getAttribute("fill-opacity");t.stroke=bZ.getAttribute("stroke");t.stroke_opacity=bZ.getAttribute("stroke-opacity");t.stroke_width=bZ.getAttribute("stroke-width");t.stroke_dasharray=bZ.getAttribute("stroke-dasharray");t.stroke_linejoin=bZ.getAttribute("stroke-linejoin");t.stroke_linecap=bZ.getAttribute("stroke-linecap")}if(bZ.tagName=="text"){bn.font_size=bZ.getAttribute("font-size");bn.font_family=bZ.getAttribute("font-family")}H.requestSelector(bZ).showGrips(true)}bc();if(bS!=bz||bR!=by){var b4=a3.length;for(var b3=0;b3<b4;++b3){if(a3[b3]==null){break}if(a3[b3].tagName!="g"){H.requestSelector(a3[b3]).resize()}}}else{var bW=bX.target;if(a3[0].nodeName=="path"&&a3[1]==null){B.select(bW)}else{if(bX.shiftKey){if(bQ!=bW){bt.removeFromSelection([bW])}}}}}return;break;case"zoom":if(j!=null){j.setAttribute("display","none")}var bY=bX.shiftKey?0.5:2;call("zoomed",{x:Math.min(bz,bS),y:Math.min(by,bR),width:Math.abs(bS-bz),height:Math.abs(bR-by),factor:bY});return;case"fhpath":var b2=bO.getAttribute("points");var bP=b2.indexOf(",");if(bP>=0){b6=b2.indexOf(",",bP+1)>=0}else{b6=b2.indexOf(" ",b2.indexOf(" ")+1)>=0}if(b6){bO=B.smoothPolylineIntoPath(bO)}break;case"line":var b0=$(bO).attr(["x1","x2","y1","y2"]);b6=(b0.x1!=b0.x2||b0.y1!=b0.y2);break;case"foreignObject":case"square":case"rect":case"image":var b0=$(bO).attr(["width","height"]);b6=(b0.width!=0||b0.height!=0)||bh==="image";break;case"circle":b6=(bO.getAttribute("r")!=0);break;case"ellipse":var b0=$(bO).attr(["rx","ry"]);b6=(b0.rx!=null||b0.ry!=null);break;case"fhellipse":if((bA.maxx-bA.minx)>0&&(bA.maxy-bA.miny)>0){bO=c({element:"ellipse",curStyles:true,attr:{cx:(bA.minx+bA.maxx)/2,cy:(bA.miny+bA.maxy)/2,rx:(bA.maxx-bA.minx)/2,ry:(bA.maxy-bA.miny)/2,id:E()}});call("changed",[bO]);b6=true}break;case"fhrect":if((bA.maxx-bA.minx)>0&&(bA.maxy-bA.miny)>0){bO=c({element:"rect",curStyles:true,attr:{x:bA.minx,y:bA.miny,width:(bA.maxx-bA.minx),height:(bA.maxy-bA.miny),id:E()}});call("changed",[bO]);b6=true}break;case"text":b6=true;ax([bO]);N.start(bO);break;case"path":bO=null;aP=true;var b9=B.mouseUp(bX,bO,bM,bL);bO=b9.element;b6=b9.keep;break;case"pathedit":b6=true;bO=null;B.mouseUp(bX);break;case"textedit":b6=false;bO=null;N.mouseUp(bX,bM,bL);break;case"rotate":b6=true;bO=null;bh="select";var bV=bt.finishUndoableChange();if(!bV.isEmpty()){a7(bV)}bc();call("changed",a3);break;default:break}var b5=aR("mouseUp",{event:bX,mouse_x:bM,mouse_y:bL},true);$.each(b5,function(ca,cb){if(cb){b6=cb.keep||b6;bO=cb.element;aP=cb.started||aP}});if(!b6&&bO!=null){bO.parentNode.removeChild(bO);bO=null;var bW=bX.target;while(bW.parentNode.parentNode.tagName=="g"){bW=bW.parentNode}if((bh!="path"||current_path_pts.length==0)&&bW.parentNode.id!="selectorParentGroup"&&bW.id!="svgcanvas"&&bW.id!="svgroot"){bt.setMode("select");ax([bW],true)}}else{if(bO!=null){bt.addedNew=true;var b8=0.2,bN;if(P.beginElement&&bO.getAttribute("opacity")!=aW.opacity){bN=$(P).clone().attr({to:aW.opacity,dur:b8}).appendTo(bO);try{bN[0].beginElement()}catch(b7){}}else{b8=0}setTimeout(function(){if(bN){bN.remove()}bO.setAttribute("opacity",aW.opacity);bO.setAttribute("style","pointer-events:inherit");aA(bO);if(bh=="path"){B.toEditMode(bO)}else{ax([bO],true)}a7(new a(bO));call("changed",[bO])},b8*1000)}}ap=null};var bB=function(bL){var bM=bL.target;var bN=bM.parentNode;if(bN===ao){return}var bO=ab(bL);if(bO.tagName==="text"&&bh!=="textedit"){var bP=R(bL.pageX,bL.pageY,p);N.select(bO,bP.x,bP.y)}if(az(bO)){return}if(ao){bf()}if(bN.tagName!=="g"||bN===X||bO===H.selectorParentGroup){return}aX(bO)};var bC=function(bL){bL.preventDefault();return false};$(aU).mousedown(bD).mousemove(bJ).click(bC).dblclick(bB);$(window).mouseup(bE);$(aU).bind("mousewheel DOMMouseScroll",function(bM){if(!bM.shiftKey){return}bM.preventDefault();p=am.getScreenCTM().inverse();var bL=R(bM.pageX,bM.pageY,p);var bN={x:bL.x,y:bL.y,width:0,height:0};if(bM.wheelDelta){if(bM.wheelDelta>=120){bN.factor=2}else{if(bM.wheelDelta<=-120){bN.factor=0.5}}}else{if(bM.detail){if(bM.detail>0){bN.factor=0.5}else{if(bM.detail<0){bN.factor=2}}}}if(!bN.factor){return}call("zoomed",bN)})}());var a9=function(bx){$(bx).click(function(by){by.preventDefault()})};var N=bt.textActions=function(){var bG;var bL;var bC;var bJ;var bD;var bQ=[];var bR,bK;var bM;var bz,bx;var bA;function bS(bT){var bU=(bL.value==="");$(bL).focus();if(!arguments.length){if(bU){bT=0}else{if(bL.selectionEnd!==bL.selectionStart){return}bT=bL.selectionEnd}}var bV;bV=bQ[bT];if(!bU){bL.setSelectionRange(bT,bT)}bC=b("text_cursor");if(!bC){bC=document.createElementNS(aT,"line");aH(bC,{id:"text_cursor",stroke:"#333","stroke-width":1});bC=b("selectorParentGroup").appendChild(bC)}if(!bD){bD=setInterval(function(){var bY=(bC.getAttribute("display")==="none");bC.setAttribute("display",bY?"inline":"none")},600)}var bX=bH(bV.x,bR.y);var bW=bH(bV.x,(bR.y+bR.height));aH(bC,{x1:bX.x,y1:bX.y,x2:bW.x,y2:bW.y,visibility:"visible",display:"inline"});if(bJ){bJ.setAttribute("d","")}}function bE(bT,bW,bV){if(bT===bW){bS(bW);return}if(!bV){bL.setSelectionRange(bT,bW)}bJ=b("text_selectblock");if(!bJ){bJ=document.createElementNS(aT,"path");aH(bJ,{id:"text_selectblock",fill:"green",opacity:0.5,style:"pointer-events:none"});b("selectorParentGroup").appendChild(bJ)}var bZ=bQ[bT];var b0=bQ[bW];bC.setAttribute("visibility","hidden");var b2=bH(bZ.x,bR.y),bY=bH(bZ.x+(b0.x-bZ.x),bR.y),bU=bH(bZ.x,bR.y+bR.height),b1=bH(bZ.x+(b0.x-bZ.x),bR.y+bR.height);var bX="M"+b2.x+","+b2.y+" L"+bY.x+","+bY.y+" "+b1.x+","+b1.y+" "+bU.x+","+bU.y+"z";aH(bJ,{d:bX,display:"inline"})}function bF(bU,bT){var bW=I.createSVGPoint();bW.x=bU;bW.y=bT;if(bQ.length==1){return 0}var bY=bG.getCharNumAtPosition(bW);if(bY<0){bY=bQ.length-2;if(bU<=bQ[0].x){bY=0}}else{if(bY>=bQ.length-2){bY=bQ.length-2}}var bX=bQ[bY];var bV=bX.x+(bX.width/2);if(bU>bV){bY++}return bY}function bO(bU,bT){bS(bF(bU,bT))}function bN(bT,bZ,bV){var bX=bL.selectionStart;var bW=bF(bT,bZ);var bY=Math.min(bX,bW);var bU=Math.max(bX,bW);bE(bY,bU,!bV)}function bI(bW,bU){var bT={x:bW,y:bU};bT.x/=af;bT.y/=af;if(bM){var bV=R(bT.x,bT.y,bM.inverse());bT.x=bV.x;bT.y=bV.y}return bT}function bH(bW,bU){var bT={x:bW,y:bU};if(bM){var bV=R(bT.x,bT.y,bM);bT.x=bV.x;bT.y=bV.y}bT.x*=af;bT.y*=af;return bT}function by(){if(bC){bC.setAttribute("visibility","hidden")}}function bP(bT){bE(0,bG.textContent.length);$(this).unbind(bT)}function bB(b0){if(!bA||!bG){return}var b1=R(b0.pageX,b0.pageY,p),bY=b1.x*af,bW=b1.y*af;var b2=bI(bY,bW);var bV=bF(b2.x,b2.y);var bX=bG.textContent;var bU=bX.substr(0,bV).replace(/[a-z0-9]+$/i,"").length;var bT=bX.substr(bV).match(/^[a-z0-9]+/i);var bZ=(bT?bT[0].length:0)+bV;bE(bU,bZ);$(b0.target).click(bP);setTimeout(function(){$(b0.target).unbind("click",bP)},300)}return{select:function(bU,bT,bV){bG=bU;N.toEditMode(bT,bV)},start:function(bT){bG=bT;N.toEditMode()},mouseDown:function(bU,bW,bV,bT){var bX=bI(bV,bT);bL.focus();bO(bX.x,bX.y);bz=bV;bx=bT},mouseMove:function(bU,bT){var bV=bI(bU,bT);bN(bV.x,bV.y)},mouseUp:function(bV,bU,bT){var bW=bI(bU,bT);bN(bW.x,bW.y,true);if(bz===bU&&bx===bT&&bV.target!==bG){N.toSelectMode(true)}},setCursor:bS,toEditMode:function(bT,bW){bA=false;bh="textedit";H.requestSelector(bG).showGrips(false);var bU=H.requestSelector(bG).selectorRect;N.init();$(bG).css("cursor","text");if(!arguments.length){bS()}else{var bV=bI(bT,bW);bO(bV.x,bV.y)}setTimeout(function(){bA=true},300)},toSelectMode:function(bT){bh="select";clearInterval(bD);bD=null;if(bJ){$(bJ).attr("display","none")}if(bC){$(bC).attr("visibility","hidden")}$(bG).css("cursor","move");if(bT){be();$(bG).css("cursor","move");call("selected",[bG]);bm([bG],true)}if(bG&&!bG.textContent.length){bt.deleteSelectedElements()}$(bL).blur();bG=false},setInputElem:function(bT){bL=bT},clear:function(){if(bh=="textedit"){N.toSelectMode()}},init:function(bX){if(!bG){return}if(!bG.parentNode){bG=a3[0];H.requestSelector(bG).showGrips(false)}var bY=bG.textContent;var bU=bY.length;var bT=bG.getAttribute("transform");bR=aC(bG);bM=bT?D(bG):null;bQ=Array(bU);bL.focus();$(bG).unbind("dblclick",bB).dblclick(bB);if(!bU){var bV={x:bR.x+(bR.width/2),width:0}}for(var bW=0;bW<bU;bW++){var bZ=bG.getStartPositionOfChar(bW);var bV=bG.getEndPositionOfChar(bW);bQ[bW]={x:bZ.x,y:bR.y,width:bV.x-bZ.x,height:bR.height}}bQ.push({x:bV.x,width:0});bE(bL.selectionStart,bL.selectionEnd,true)}}}();var B=this.pathActions=function(){var bx=false;var bQ={};var bM;var bK;var bC={2:["x","y"],4:["x","y"],6:["x","y","x1","y1","x2","y2"],8:["x","y","x1","y1"],10:["x","y","r1","r2","angle","largeArcFlag","sweepFlag"],12:["x"],14:["y"],16:["x","y","x2","y2"],18:["x","y"]};function bV(){return bK}function bD(bX){bX.setAttribute("d",B.convertPath(bX))}function bH(b2,b4,bZ){var b3=b2.pathSegList;if(bg.pathInsertItemBefore){b3.insertItemBefore(b4,bZ);return}var bY=b3.numberOfItems;var bX=[];for(var b1=0;b1<bY;b1++){var b0=b3.getItem(b1);bX.push(b0)}b3.clear();for(var b1=0;b1<bY;b1++){if(b1==bZ){b3.appendItem(b4)}b3.appendItem(bX[b1])}}function bG(b2,bZ){var bY=bC[b2],bX=bY.length;var b0=Array(bX);for(var b1=0;b1<bX;b1++){b0[b1]=bZ[bY[b1]]}return b0}function bF(){var bY=b("pathpointgrip_container");if(!bY){var bX=b("selectorParentGroup");bY=bX.appendChild(document.createElementNS(aT,"g"));bY.id="pathpointgrip_container"}return bY}var bI=function(bZ,bX,b2){var b1=bF();var b0=b("pathpointgrip_"+bZ);if(!b0){b0=document.createElementNS(aT,"circle");aH(b0,{id:"pathpointgrip_"+bZ,display:"none",r:4,fill:"#0FF",stroke:"#00F","stroke-width":2,cursor:"move",style:"pointer-events:all","xlink:title":aJ.pathNodeTooltip});b0=b1.appendChild(b0);var bY=$("#pathpointgrip_"+bZ);bY.dblclick(function(){if(bK){bK.setSegType()}})}if(bX&&b2){aH(b0,{cx:bX,cy:b2,display:"inline"})}return b0};var bR=function(bX,b1){var bY=bX.index;var bZ=bI(bY);if(b1){var b0=bB(bX);aH(bZ,{cx:b0.x,cy:b0.y,display:"inline"})}return bZ};var bN=function(bZ,bY){var b2=bZ.index;var b3=b("segline_"+b2);if(!b3){var b1=bF();b3=document.createElementNS(aT,"path");aH(b3,{id:"segline_"+b2,display:"none",fill:"none",stroke:"#0FF","stroke-width":2,style:"pointer-events:none",d:"M0,0 0,0"});b1.appendChild(b3)}if(bY){var bX=bZ.prev;if(!bX){b3.setAttribute("display","none");return b3}var b5=bB(bX);bA(2,0,[b5.x,b5.y],b3);var b4=bG(bZ.type,bZ.item,true);for(var b0=0;b0<b4.length;b0+=2){var b5=bB(bZ,{x:b4[b0],y:b4[b0+1]});b4[b0]=b5.x;b4[b0+1]=b5.y}bA(bZ.type,1,b4,b3)}return b3};var by=function(b1){var b7=b1.item;var b5=b1.index;if(!("x1" in b7)||!("x2" in b7)){return null}var b3={};var b4=bF();var bY=bK.segs[b5-1].item;var b0=[bY,b7];for(var b2=1;b2<3;b2++){var bX=b5+"c"+b2;var b9=b3["c"+b2+"_line"]=b("ctrlLine_"+bX);if(!b9){b9=document.createElementNS(aT,"line");aH(b9,{id:"ctrlLine_"+bX,stroke:"#555","stroke-width":1,style:"pointer-events:none"});b4.appendChild(b9)}var b8=bB(b1,{x:b7["x"+b2],y:b7["y"+b2]});var bZ=bB(b1,{x:b0[b2-1].x,y:b0[b2-1].y});aH(b9,{x1:b8.x,y1:b8.y,x2:bZ.x,y2:bZ.y,display:"inline"});b3["c"+b2+"_line"]=b9;var b6=b3["c"+b2]=b("ctrlpointgrip_"+bX);if(!b6){b6=document.createElementNS(aT,"circle");aH(b6,{id:"ctrlpointgrip_"+bX,display:"none",r:4,fill:"#0FF",stroke:"#55F","stroke-width":1,cursor:"move",style:"pointer-events:all","xlink:title":aJ.pathCtrlPtTooltip});b4.appendChild(b6)}aH(b6,{cx:b8.x,cy:b8.y,display:"inline"});b3["c"+b2]=b6}return b3};function bB(bX,b1){var bY={x:b1?b1.x:bX.item.x,y:b1?b1.y:bX.item.y},b0=bX.path;if(b0.matrix){var bZ=R(bY.x,bY.y,b0.matrix);bY=bZ}bY.x*=af;bY.y*=af;return bY}function bP(bZ,bY){var bX={x:bZ.x,y:bZ.y};if(bY.matrix){var bZ=R(bX.x,bX.y,bY.imatrix);bX.x=bZ.x;bX.y=bZ.y}bX.x/=af;bX.y/=af;return bX}function bL(bY,b0){var bZ=this;bZ.index=bY;bZ.selected=false;bZ.type=b0.pathSegType;var bX;bZ.addGrip=function(){bX=bZ.ptgrip=bR(bZ,true);bZ.ctrlpts=by(bZ,true);bZ.segsel=bN(bZ,true)};bZ.item=b0;bZ.show=function(b1){if(bX){bX.setAttribute("display",b1?"inline":"none");bZ.segsel.setAttribute("display",b1?"inline":"none");bZ.showCtrlPts(b1)}};bZ.select=function(b1){if(bX){bX.setAttribute("stroke",b1?"#0FF":"#00F");bZ.segsel.setAttribute("display",b1?"inline":"none");if(bZ.ctrlpts){bZ.selectCtrls(b1)}bZ.selected=b1}};bZ.selectCtrls=function(b1){$("#ctrlpointgrip_"+bZ.index+"c1, #ctrlpointgrip_"+bZ.index+"c2").attr("fill",b1?"#0FF":"#EEE")};bZ.update=function(b1){b0=bZ.item;if(bX){var b2=bB(bZ);aH(bX,{cx:b2.x,cy:b2.y});bN(bZ,true);if(bZ.ctrlpts){if(b1){bZ.item=bK.elem.pathSegList.getItem(bZ.index);bZ.type=bZ.item.pathSegType}by(bZ)}}};bZ.move=function(b3,b2){var b5=bZ.item;var b8=bZ;if(b8.ctrlpts){var b1=[b5.x+=b3,b5.y+=b2,b5.x1,b5.y1,b5.x2+=b3,b5.y2+=b2]}else{var b1=[b5.x+=b3,b5.y+=b2]}bA(b8.type,b8.index,b1);if(bZ.next&&bZ.next.ctrlpts){var b4=bZ.next.item;var b6=[b4.x,b4.y,b4.x1+=b3,b4.y1+=b2,b4.x2,b4.y2];bA(bZ.next.type,bZ.next.index,b6)}if(bZ.mate){var b5=bZ.mate.item;var b7=[b5.x+=b3,b5.y+=b2];bA(bZ.mate.type,bZ.mate.index,b7)}bZ.update(true);if(bZ.next){bZ.next.update(true)}};bZ.setLinked=function(b2){var b1,b6,b4;if(b2==2){b6=1;b1=bZ.next;if(!b1){return}b4=bZ.item}else{b6=2;b1=bZ.prev;if(!b1){return}b4=b1.item}var b3=b1.item;b3["x"+b6]=b4.x+(b4.x-bZ.item["x"+b2]);b3["y"+b6]=b4.y+(b4.y-bZ.item["y"+b2]);var b5=[b3.x,b3.y,b3.x1,b3.y1,b3.x2,b3.y2];bA(b1.type,b1.index,b5);b1.update(true)};bZ.moveCtrl=function(b3,b2,b1){var b4=bZ.item;b4["x"+b3]+=b2;b4["y"+b3]+=b1;var b5=[b4.x,b4.y,b4.x1,b4.y1,b4.x2,b4.y2];bA(bZ.type,bZ.index,b5);bZ.update(true)};bZ.setType=function(b2,b1){bA(b2,bY,b1);bZ.type=b2;bZ.item=bK.elem.pathSegList.getItem(bY);bZ.showCtrlPts(b2===6);bZ.ctrlpts=by(bZ);bZ.update(true)};bZ.showCtrlPts=function(b2){if(bZ.ctrlpts){for(var b1 in bZ.ctrlpts){bZ.ctrlpts[b1].setAttribute("display",b2?"inline":"none")}}}}function bT(bX){if(!bX||bX.tagName!=="path"){return false}var bY=bK=this;this.elem=bX;this.segs=[];this.selected_pts=[];this.init=function(){$(bF()).find("*").attr("display","none");var b2=bX.pathSegList;var b8=b2.numberOfItems;bY.segs=[];bY.selected_pts=[];bY.first_seg=null;for(var b5=0;b5<b8;b5++){var b9=b2.getItem(b5);var b6=new bL(b5,b9);b6.path=bY;bY.segs.push(b6)}var b0=bY.segs;var b7=null;for(var b5=0;b5<b8;b5++){var b4=b0[b5];var b3=(b5+1)>=b8?null:b0[b5+1];var bZ=(b5-1)<0?null:b0[b5-1];if(b4.type===2){if(bZ&&bZ.type!==1){var b1=b0[b7];b1.next=b0[b7+1];b1.next.prev=b1;b1.addGrip()}b7=b5}else{if(b3&&b3.type===1){b4.next=b0[b7+1];b4.next.prev=b4;b4.mate=b0[b7];b4.addGrip();if(bY.first_seg==null){bY.first_seg=b4}}else{if(!b3){if(b4.type!==1){var b1=b0[b7];b1.next=b0[b7+1];b1.next.prev=b1;b1.addGrip();b4.addGrip();if(!bY.first_seg){bY.first_seg=b0[b7]}}}else{if(b4.type!==1){b4.addGrip();if(b3&&b3.type!==2){b4.next=b3;b4.next.prev=b4}}}}}}return bY};this.init();this.update=function(){if(az(bY.elem)){bY.matrix=D(bK.elem);bY.imatrix=bY.matrix.inverse()}bY.eachSeg(function(bZ){this.item=bX.pathSegList.getItem(bZ);this.update()});return bY};this.eachSeg=function(b2){var bZ=bY.segs.length;for(var b1=0;b1<bZ;b1++){var b0=b2.call(bY.segs[b1],b1);if(b0===false){break}}};this.addSeg=function(ca){var b9=bY.segs[ca];if(!b9.prev){return}var b6=b9.prev;var b5;switch(b9.item.pathSegType){case 4:var cc=(b9.item.x+b6.item.x)/2;var cb=(b9.item.y+b6.item.y)/2;b5=bX.createSVGPathSegLinetoAbs(cc,cb);break;case 6:var ce=(b6.item.x+b9.item.x1)/2;var b4=(b9.item.x1+b9.item.x2)/2;var b8=(b9.item.x2+b9.item.x)/2;var b3=(ce+b4)/2;var b1=(b4+b8)/2;var cc=(b3+b1)/2;var cd=(b6.item.y+b9.item.y1)/2;var b2=(b9.item.y1+b9.item.y2)/2;var b7=(b9.item.y2+b9.item.y)/2;var b0=(cd+b2)/2;var bZ=(b2+b7)/2;var cb=(b0+bZ)/2;b5=bX.createSVGPathSegCurvetoCubicAbs(cc,cb,ce,cd,b3,b0);var cf=[b9.item.x,b9.item.y,b1,bZ,b8,b7];bA(b9.type,ca,cf);break}bH(bX,b5,ca)};this.deleteSeg=function(b0){var bZ=bY.segs[b0];var b3=bX.pathSegList;bZ.show(false);var b1=bZ.next;if(bZ.mate){var b4=[b1.item.x,b1.item.y];bA(2,b1.index,b4);bA(4,bZ.index,b4);b3.removeItem(bZ.mate.index)}else{if(!bZ.prev){var b2=bZ.item;var b4=[b1.item.x,b1.item.y];bA(2,bZ.next.index,b4);b3.removeItem(b0)}else{b3.removeItem(b0)}}};this.endChanges=function(b0){if(aK){bD(bY.elem)}var bZ=new aD(bX,{d:bY.last_d},b0);a7(bZ);call("changed",[bX])};this.subpathIsClosed=function(b0){var bZ=false;bK.eachSeg(function(b1){if(b1<=b0){return true}if(this.type===2){return false}else{if(this.type===1){bZ=true;return false}}});return bZ};this.addPtsToSelection=function(b1){if(!$.isArray(b1)){b1=[b1]}for(var b2=0;b2<b1.length;b2++){var b0=b1[b2];var bZ=bY.segs[b0];if(bZ.ptgrip){if($.inArray(b0,bY.selected_pts)==-1&&b0>=0){bY.selected_pts.push(b0)}}}bY.selected_pts.sort();var b2=bY.selected_pts.length,b4=new Array(b2);while(b2--){var b3=bY.selected_pts[b2];var bZ=bY.segs[b3];bZ.select(true);b4[b2]=bZ.ptgrip}B.canDeleteNodes=true;B.closed_subpath=bY.subpathIsClosed(bY.selected_pts[0]);call("selected",b4)};this.removePtFromSelection=function(bZ){var b0=$.inArray(bZ,bY.selected_pts);if(b0==-1){return}bY.segs[bZ].select(false);bY.selected_pts.splice(b0,1)};this.clearSelection=function(){bY.eachSeg(function(bZ){this.select(false)});bY.selected_pts=[]};this.selectPt=function(b0,bZ){bY.clearSelection();if(b0==null){bY.eachSeg(function(b1){if(this.prev){b0=b1}})}bY.addPtsToSelection(b0);if(bZ){bY.dragctrl=bZ;if(bJ){bY.segs[b0].setLinked(bZ)}}};this.storeD=function(){this.last_d=bX.getAttribute("d")};this.show=function(bZ){bY.eachSeg(function(){this.show(bZ)});if(bZ){bY.selectPt(bY.first_seg.index)}return bY};this.movePts=function(b2,b1){var b0=bY.selected_pts.length;while(b0--){var bZ=bY.segs[bY.selected_pts[b0]];bZ.move(b2,b1)}};this.moveCtrl=function(b1,b0){var bZ=bY.segs[bY.selected_pts[0]];bZ.moveCtrl(bY.dragctrl,b1,b0);if(bJ){bZ.setLinked(bY.dragctrl)}};this.setSegType=function(b6){bY.storeD();var cf=bY.selected_pts.length;var cb;while(cf--){var cd=bY.selected_pts[cf];var b0=bY.segs[cd];var cc=b0.prev;if(!cc){continue}if(!b6){cb="Toggle Path Segment Type";var ca=b0.type;b6=(ca==6)?4:6}b6=b6-0;var b7=b0.item.x;var b5=b0.item.y;var b2=cc.item.x;var b1=cc.item.y;var ce;switch(b6){case 6:if(b0.olditem){var bZ=b0.olditem;ce=[b7,b5,bZ.x1,bZ.y1,bZ.x2,bZ.y2]}else{var b9=b7-b2;var b8=b5-b1;var b4=(b2+(b9/3));var b3=(b1+(b8/3));var ch=(b7-(b9/3));var cg=(b5-(b8/3));ce=[b7,b5,b4,b3,ch,cg]}break;case 4:ce=[b7,b5];b0.olditem=b0.item;break}b0.setType(b6,ce)}bK.endChanges(cb);return}}function bz(bX){var bY=bQ[bX.id];if(!bY){bY=bQ[bX.id]=new bT(bX)}return bY}var bO=[],bM=null,bU=[],bJ=false,bS=false;var bE=function(b0){var b6=b0.points;var b4=b6.numberOfItems;if(b4>=4){var bY=b6.getItem(0),b2=null;var b5=[];b5.push(["M",bY.x,",",bY.y," C"].join(""));for(var b1=1;b1<=(b4-4);b1+=3){var bX=b6.getItem(b1);var b9=b6.getItem(b1+1);var bZ=b6.getItem(b1+2);if(b2){var b7=Z(b2,bX,bY);if(b7&&b7.length==2){var b3=b5[b5.length-1].split(",");b3[2]=b7[0].x;b3[3]=b7[0].y;b5[b5.length-1]=b3.join(",");bX=b7[1]}}b5.push([bX.x,bX.y,b9.x,b9.y,bZ.x,bZ.y].join(","));bY=bZ;b2=b9}b5.push("L");for(;b1<b4;++b1){var b8=b6.getItem(b1);b5.push([b8.x,b8.y].join(","))}b5=b5.join(" ");b0=c({element:"path",curStyles:true,attr:{id:E(),d:b5,fill:"none"}});call("changed",[b0])}return b0};var bA=function(b6,b5,b7,bX){var b8=bX||bV().elem;var bY="createSVGPathSeg"+bO[b6];var b1=b8[bY].apply(b8,b7);if(bg.pathReplaceItem){b8.pathSegList.replaceItem(b1,b5)}else{var bZ=b8.pathSegList;var b4=bZ.numberOfItems;var b3=[];for(var b2=0;b2<b4;b2++){var b0=bZ.getItem(b2);b3.push(b0)}bZ.clear();for(var b2=0;b2<b4;b2++){if(b2==b5){bZ.appendItem(b1)}else{bZ.appendItem(b3[b2])}}}};var bW=function(){var b8=bK.elem;var cd=az(b8,true);if(!cd){return}w[0]=bK.oldbbox;var b3=aC(b8),b7=w[0],bY=b7.x+b7.width/2,bX=b7.y+b7.height/2,ch=b3.x+b3.width/2,cf=b3.y+b3.height/2,b5=ch-bY,b4=cf-bX,b6=Math.sqrt(b5*b5+b4*b4),b1=Math.atan2(b4,b5)+cd;ch=b6*Math.cos(b1)+bY;cf=b6*Math.sin(b1)+bX;var cb=function(ci,cj){b5=ci-bY;b4=cj-bX;b6=Math.sqrt(b5*b5+b4*b4);b1=Math.atan2(b4,b5)+cd;b5=b6*Math.cos(b1)+bY;b4=b6*Math.sin(b1)+bX;b5-=ch;b4-=cf;b6=Math.sqrt(b5*b5+b4*b4);b1=Math.atan2(b4,b5)-cd;return{x:(b6*Math.cos(b1)+ch)/1,y:(b6*Math.sin(b1)+cf)/1}};var ce=b8.pathSegList,ca=ce.numberOfItems;while(ca){ca-=1;var cc=ce.getItem(ca),b0=cc.pathSegType;if(b0==1){continue}var cg=cb(cc.x,cc.y),b9=[cg.x,cg.y];if(cc.x1!=null&&cc.x2!=null){c_vals1=cb(cc.x1,cc.y1);c_vals2=cb(cc.x2,cc.y2);b9.splice(b9.length,0,c_vals1.x,c_vals1.y,c_vals2.x,c_vals2.y)}bA(b0,ca,b9)}b3=aC(b8);w[0].x=b3.x;w[0].y=b3.y;w[0].width=b3.width;w[0].height=b3.height;var bZ=I.createSVGTransform(),b2=a0(b8);bZ.setRotate((cd*180/Math.PI),ch,cf);b2.replaceItem(bZ,0)};return{init:function(){bO=[0,"ClosePath"];var bX=["Moveto","Lineto","CurvetoCubic","CurvetoQuadratic","Arc","LinetoHorizontal","LinetoVertical","CurvetoCubicSmooth","CurvetoQuadraticSmooth"];$.each(bX,function(bY,bZ){bO.push(bZ+"Abs");bO.push(bZ+"Rel")})},getPath:function(){return bK},mouseDown:function(b5,bZ,b4,b3){if(bh=="path"){return}if(!bK){return}bK.storeD();var bX=b5.target.id;if(bX.substr(0,14)=="pathpointgrip_"){var bY=bK.cur_pt=parseInt(bX.substr(14));bK.dragging=[b4,b3];var b2=bK.segs[bY];if(!b5.shiftKey){if(bK.selected_pts.length<=1||!b2.selected){bK.clearSelection()}bK.addPtsToSelection(bY)}else{if(b2.selected){bK.removePtFromSelection(bY)}else{bK.addPtsToSelection(bY)}}}else{if(bX.indexOf("ctrlpointgrip_")==0){bK.dragging=[b4,b3];var b1=bX.split("_")[1].split("c");var bY=b1[0]-0;var b0=b1[1]-0;bK.selectPt(bY,b0)}}if(!bK.dragging){if(j==null){j=H.getRubberBandBox()}aH(j,{x:b4*af,y:b3*af,width:0,height:0,display:"inline"},100)}},mouseMove:function(b0,bX){bS=true;if(bh=="path"){var bZ=b("path_stretch_line");if(bZ){bZ.setAttribute("x2",b0);bZ.setAttribute("y2",bX)}return}if(bK.dragging){var b3=bP({x:bK.dragging[0],y:bK.dragging[1]},bK);var bY=bP({x:b0,y:bX},bK);var b2=bY.x-b3.x;var b1=bY.y-b3.y;bK.dragging=[b0,bX];if(bK.dragctrl){bK.moveCtrl(b2,b1)}else{bK.movePts(b2,b1)}}else{bK.selected_pts=[];bK.eachSeg(function(b6){var b4=this;if(!b4.next&&!b4.prev){return}var b7=b4.item;var b5=j.getBBox();var ca=bB(b4);var b9={x:ca.x,y:ca.y,width:0,height:0};var b8=aE.rectsIntersect(b5,b9);this.select(b8);if(b8){bK.selected_pts.push(b4.index)}})}},mouseUp:function(b8,bZ,bY,bX){if(bh=="path"){var b5=bY/af,b4=bX/af,b0=b("path_stretch_line");if(L.gridSnapping){b5=aq(b5);b4=aq(b4);bY=aq(bY);bX=aq(bX)}if(!b0){b0=document.createElementNS(aT,"line");aH(b0,{id:"path_stretch_line",stroke:"#22C","stroke-width":"0.5"});b0=b("selectorParentGroup").appendChild(b0)}b0.setAttribute("display","inline");var ci=null;if(bU.length==0){bU.push(b5);bU.push(b4);d_attr="M"+b5+","+b4+" ";c({element:"path",curStyles:true,attr:{d:d_attr,id:bo(),opacity:aW.opacity/2,}});aH(b0,{x1:bY,y1:bX,x2:bY,y2:bX});var b2=bx?bK.segs.length:0;bI(b2,bY,bX)}else{var ce=bU.length;var b1=6/af;var cd=false;while(ce){ce-=2;var b9=bU[ce],b7=bU[ce+1];if(b5>=(b9-b1)&&b5<=(b9+b1)&&b4>=(b7-b1)&&b4<=(b7+b1)){cd=true;break}}var cb=E();if(cb in bQ){delete bQ[cb]}var ch=b(cb);var cg=bU.length;if(cd){if(ce==0&&cg>=6){var ck=bU[0];var cj=bU[1];d_attr+=["L",ck,",",cj,"z"].join("");ch.setAttribute("d",d_attr)}else{if(cg<3){ci=false;return ci}}$(b0).remove();bZ=ch;bU=[];aP=false;if(bx){if(bK.matrix){F(ch,{},bK.matrix.inverse())}var cl=ch.getAttribute("d");var cf=$(bK.elem).attr("d");$(bK.elem).attr("d",cf+cl);$(ch).remove();if(bK.matrix){bW()}bK.init();B.toEditMode(bK.elem);bK.selectPt();return false}}else{if(!$.contains(aU,ab(b8))){console.log("Clicked outside canvas");return false}var cc=bU[cg-2],ca=bU[cg-1];if(b8.shiftKey){var b6=aE.snapToAngle(cc,ca,b5,b4);b5=b6.x;b4=b6.y}bU.push(b5);bU.push(b4);d_attr+="L"+S(b5)+","+S(b4)+" ";ch.setAttribute("d",d_attr);b5*=af;b4*=af;aH(b0,{x1:b5,y1:b4,x2:b5,y2:b4});var b2=(bU.length/2-1);if(bx){b2+=bK.segs.length}bI(b2,b5,b4)}ci=true}return{keep:ci,element:bZ}}if(bK.dragging){var b3=bK.cur_pt;bK.dragging=false;bK.dragctrl=false;bK.update();if(bS){bK.endChanges("Move path point(s)")}if(!b8.shiftKey&&!bS){bK.selectPt(b3)}}else{if(j&&j.getAttribute("display")!="none"){j.setAttribute("display","none");if(j.getAttribute("width")<=2&&j.getAttribute("height")<=2){B.toSelectMode(b8.target)}}else{B.toSelectMode(b8.target)}}bS=false},clearData:function(){bQ={}},toEditMode:function(bX){bK=bz(bX);bh="pathedit";be();bK.show(true).update();bK.oldbbox=aC(bK.elem);bx=false},toSelectMode:function(bX){var bY=(bX==bK.elem);bh="select";bK.show(false);bM=false;be();if(bK.matrix){bW()}if(bY){call("selected",[bX]);bm([bX],true)}},addSubPath:function(bX){if(bX){bh="path";bx=true}else{B.clear(true);B.toEditMode(bK.elem)}},select:function(bX){if(bM==bX){B.toEditMode(bX);bh="pathedit"}else{bM=bX}},reorient:function(){var bZ=a3[0];if(!bZ){return}var b0=az(bZ);if(b0==0){return}var bX=new aI("Reorient path");var bY={d:bZ.getAttribute("d"),transform:bZ.getAttribute("transform")};bX.addSubCommand(new aD(bZ,bY));be();this.resetOrientation(bZ);a7(bX);bz(bZ).show(false).matrix=null;this.clear();bm([bZ],true);call("changed",a3)},clear:function(bX){bM=null;if(bh=="path"&&bU.length>0){var bY=b(E());$(b("path_stretch_line")).remove();$(bY).remove();$(b("pathpointgrip_container")).find("*").attr("display","none");bU=[];aP=false}else{if(bh=="pathedit"){this.toSelectMode()}}if(bK){bK.init().show(false)}},resetOrientation:function(b5){if(b5==null||b5.nodeName!="path"){return false}var b1=a0(b5);var bX=u(b1).matrix;b1.clear();b5.removeAttribute("transform");var bY=b5.pathSegList;var b2=bY.numberOfItems;for(var b0=0;b0<b2;++b0){var bZ=bY.getItem(b0);var b3=bZ.pathSegType;if(b3==1){continue}var b4=[];$.each(["",1,2],function(b7,ca){var b6=bZ["x"+ca],b9=bZ["y"+ca];if(b6&&b9){var b8=R(b6,b9,bX);b4.splice(b4.length,0,b8.x,b8.y)}});bA(b3,b0,b4,b5)}},zoomChange:function(){if(bh=="pathedit"){bK.update()}},getNodePoint:function(){var bY=bK.selected_pts.length?bK.selected_pts[0]:1;var bX=bK.segs[bY];return{x:bX.item.x,y:bX.item.y,type:bX.type}},linkControlPoints:function(bX){bJ=bX},clonePathNode:function(){bK.storeD();var bY=bK.selected_pts;var bX=bK.segs;var bZ=bY.length;var b1=[];while(bZ--){var b0=bY[bZ];bK.addSeg(b0);b1.push(b0+bZ);b1.push(b0+bZ+1)}bK.init().addPtsToSelection(b1);bK.endChanges("Clone path node(s)")},opencloseSubPath:function(){var bX=bK.selected_pts;if(bX.length!==1){return}var b0=bK.elem;var b7=b0.pathSegList;var b6=b7.numberOfItems;var b5=bX[0];var b8=null;var bZ=null;bK.eachSeg(function(cd){if(this.type===2&&cd<=b5){bZ=this.item}if(cd<=b5){return true}if(this.type===2){b8=cd;return false}else{if(this.type===1){b8=false;return false}}});if(b8==null){b8=bK.segs.length-1}if(b8!==false){var b1=b0.createSVGPathSegLinetoAbs(bZ.x,bZ.y);var ca=b0.createSVGPathSegClosePath();if(b8==bK.segs.length-1){b7.appendItem(b1);b7.appendItem(ca)}else{bH(b0,ca,b8);bH(b0,b1,b8)}bK.init().selectPt(b8+1);return}var b2=bK.segs[b5];if(b2.mate){b7.removeItem(b5);b7.removeItem(b5);bK.init().selectPt(b5-1);return}var bY,cc;for(var b3=0;b3<b7.numberOfItems;b3++){var b9=b7.getItem(b3);if(b9.pathSegType===2){bY=b3}else{if(b3===b5){b7.removeItem(bY)}else{if(b9.pathSegType===1&&b5<b3){cc=b3-1;b7.removeItem(b3);break}}}}var b4=(b5-bY)-1;while(b4--){bH(b0,b7.getItem(bY),cc)}var cb=b7.getItem(bY);bA(2,bY,[cb.x,cb.y]);var b3=b5;bK.init().selectPt(0)},deletePathNode:function(){if(!B.canDeleteNodes){return}bK.storeD();var bX=bK.selected_pts;var bY=bX.length;while(bY--){var b1=bX[bY];bK.deleteSeg(b1)}var bZ=function(){var b4=bK.elem.pathSegList;var b3=b4.numberOfItems;var b2=function(ca,b9){while(b9--){b4.removeItem(ca)}};if(b3<=1){return true}while(b3--){var b7=b4.getItem(b3);if(b7.pathSegType===1){var b6=b4.getItem(b3-1);var b5=b4.getItem(b3-2);if(b6.pathSegType===2){b2(b3-1,2);bZ();break}else{if(b5.pathSegType===2){b2(b3-2,3);bZ();break}}}else{if(b7.pathSegType===2){if(b3>0){var b8=b4.getItem(b3-1).pathSegType;if(b8===2){b2(b3-1,1);bZ();break}else{if(b8===1&&b4.numberOfItems-1===b3){b2(b3,1);bZ();break}}}}}}return false};bZ();if(bK.elem.pathSegList.numberOfItems<=1){B.toSelectMode(bK.elem);bt.deleteSelectedElements();return}bK.init();bK.clearSelection();if(window.opera){var b0=$(bK.elem);b0.attr("d",b0.attr("d"))}bK.endChanges("Delete path node(s)")},smoothPolylineIntoPath:bE,setSegType:function(bX){bK.setSegType(bX)},moveNode:function(bX,b1){var bZ=bK.selected_pts;if(!bZ.length){return}bK.storeD();var bY=bK.segs[bZ[0]];var b0={x:0,y:0};b0[bX]=b1-bY.item[bX];bY.move(b0.x,b0.y);bK.endChanges("Move path point")},fixEnd:function(b3){var bZ=b3.pathSegList;var bY=bZ.numberOfItems;var bX;for(var b0=0;b0<bY;++b0){var b2=bZ.getItem(b0);if(b2.pathSegType===2){bX=b2}if(b2.pathSegType===1){var b1=bZ.getItem(b0-1);if(b1.x!=bX.x||b1.y!=bX.y){var b4=b3.createSVGPathSegLinetoAbs(bX.x,bX.y);bH(b3,b4,b0);B.fixEnd(b3);break}}}if(aK){bD(b3)}},convertPath:function(b6,b5){var bX=b6.pathSegList;var ca=bX.numberOfItems;var b8=0,b7=0;var ce="";var b2=null;for(var b9=0;b9<ca;++b9){var cc=bX.getItem(b9);var b4=cc.x||0,b3=cc.y||0,cd=cc.x1||0,bZ=cc.y1||0,cb=cc.x2||0,bY=cc.y2||0;var b0=cc.pathSegType;var cf=G[b0]["to"+(b5?"Lower":"Upper")+"Case"]();var b1=function(cg,ch,ci){var cj="";var ch=ch?" "+ch.join(" "):"";var ci=ci?" "+bj(ci):"";$.each(cg,function(ck,cl){cg[ck]=bj(cl)});ce+=cf+cg.join(" ")+ch+ci};switch(b0){case 1:ce+="z";break;case 12:b4-=b8;case 13:if(b5){b8+=b4}else{b4+=b8;b8=b4}b1([[b4]]);break;case 14:b3-=b7;case 15:if(b5){b7+=b3}else{b3+=b7;b7=b3}b1([[b3]]);break;case 2:case 4:case 18:b4-=b8;b3-=b7;case 5:case 3:if(b2&&bX.getItem(b9-1).pathSegType===1&&!b5){b8=b2[0];b7=b2[1]}case 19:if(b5){b8+=b4;b7+=b3}else{b4+=b8;b3+=b7;b8=b4;b7=b3}if(b0===3){b2=[b8,b7]}b1([[b4,b3]]);break;case 6:b4-=b8;cd-=b8;cb-=b8;b3-=b7;bZ-=b7;bY-=b7;case 7:if(b5){b8+=b4;b7+=b3}else{b4+=b8;cd+=b8;cb+=b8;b3+=b7;bZ+=b7;bY+=b7;b8=b4;b7=b3}b1([[cd,bZ],[cb,bY],[b4,b3]]);break;case 8:b4-=b8;cd-=b8;b3-=b7;bZ-=b7;case 9:if(b5){b8+=b4;b7+=b3}else{b4+=b8;cd+=b8;b3+=b7;bZ+=b7;b8=b4;b7=b3}b1([[cd,bZ],[b4,b3]]);break;case 10:b4-=b8;b3-=b7;case 11:if(b5){b8+=b4;b7+=b3}else{b4+=b8;b3+=b7;b8=b4;b7=b3}b1([[cc.r1,cc.r2]],[cc.angle,(cc.largeArcFlag?1:0),(cc.sweepFlag?1:0)],[b4,b3]);break;case 16:b4-=b8;cb-=b8;b3-=b7;bY-=b7;case 17:if(b5){b8+=b4;b7+=b3}else{b4+=b8;cb+=b8;b3+=b7;bY+=b7;b8=b4;b7=b3}b1([[cb,bY],[b4,b3]]);break}}return ce}}}();B.init();var z=this.removeUnusedDefElems=function(){var bG=am.getElementsByTagNameNS(aT,"defs");if(!bG||!bG.length){return 0}var bK=[],bI=0;var bL=["fill","stroke","filter","marker-start","marker-mid","marker-end"];var bE=bL.length;var bM=am.getElementsByTagNameNS(aT,"*");var bz=bM.length;for(var bH=0;bH<bz;bH++){var bB=bM[bH];for(var bF=0;bF<bE;bF++){var bC=ar(bB.getAttribute(bL[bF]));if(bC){bK.push(bC.substr(1))}}var bx=bk(bB);if(bx&&bx.indexOf("#")==0){bK.push(bx.substr(1))}}var bD=$(am).find("linearGradient, radialGradient, filter, marker, svg");defelem_ids=[],bH=bD.length;while(bH--){var bJ=bD[bH];var by=bJ.id;if($.inArray(by,bK)==-1){bJ.parentNode.removeChild(bJ);bI++}}var bH=bG.length;while(bH--){var bA=bG[bH];if(!bA.getElementsByTagNameNS(aT,"*").length){bA.parentNode.removeChild(bA)}}return bI};var i=this.svgCanvasToString=function(){while(z()>0){}B.clear(true);$.each(am.childNodes,function(bz,bA){if(bz&&bA.nodeType==8&&bA.data.indexOf("Created with")!=-1){am.insertBefore(bA,am.firstChild)}});if(ao){bf();ax([ao])}var by=[];$(am).find("g:data(gsvg)").each(function(){var bB=this.attributes;var bz=bB.length;for(var bC=0;bC<bz;bC++){if(bB[bC].nodeName=="id"||bB[bC].nodeName=="style"){bz--}}if(bz<=0){var bA=this.firstChild;by.push(bA);$(this).replaceWith(bA)}});var bx=a8(am,0);if(by.length){$(by).each(function(){s(this)})}return bx};var a8=this.svgToString=function(bz,by){var bA=new Array(),bE=aE.toXml;if(bz){aA(bz);var bL=bz.attributes,bH,bC,bJ=bz.childNodes;for(var bC=0;bC<by;bC++){bA.push(" ")}bA.push("<");bA.push(bz.nodeName);if(bz.id=="svgcontent"){var bI=d();bA.push(' width="'+bI.w+'" height="'+bI.h+'" xmlns="'+aT+'"');var bD={};$(bz).find("*").andSelf().each(function(){var bM=this;$.each(this.attributes,function(bO,bN){var bP=bN.namespaceURI;if(bP&&!bD[bP]&&au[bP]!=="xmlns"&&au[bP]!=="xml"){bD[bP]=true;bA.push(" xmlns:"+au[bP]+'="'+bP+'"')}})});var bC=bL.length;while(bC--){bH=bL.item(bC);var bG=bE(bH.nodeValue);if(bH.nodeName.indexOf("xmlns:")===0){continue}if(bG!=""&&$.inArray(bH.localName,["width","height","xmlns","x","y","viewBox","id","overflow"])==-1){if(!bH.namespaceURI||au[bH.namespaceURI]){bA.push(" ");bA.push(bH.nodeName);bA.push('="');bA.push(bG);bA.push('"')}}}}else{for(var bC=bL.length-1;bC>=0;bC--){bH=bL.item(bC);var bG=bE(bH.nodeValue);if($.inArray(bH.localName,["-moz-math-font-style","_moz-math-font-style"])!==-1){continue}if(bG!=""){if(bG.indexOf("pointer-events")===0){continue}if(bH.localName==="class"&&bG.indexOf("se_")===0){continue}bA.push(" ");if(bH.localName==="d"){bG=B.convertPath(bz,true)}if(!isNaN(bG)){bG=bj(bG)}if(al.apply&&bz.nodeName==="image"&&bH.localName==="href"&&al.images&&al.images==="embed"){var bB=bb[bG];if(bB){bG=bB}}if(!bH.namespaceURI||bH.namespaceURI==aT||au[bH.namespaceURI]){bA.push(bH.nodeName);bA.push('="');bA.push(bG);bA.push('"')}}}}if(bz.hasChildNodes()){bA.push(">");by++;var bF=false;for(var bC=0;bC<bJ.length;bC++){var bx=bJ.item(bC);switch(bx.nodeType){case 1:bA.push("\n");bA.push(a8(bJ.item(bC),by));break;case 3:var bK=bx.nodeValue.replace(/^\s+|\s+$/g,"");if(bK!=""){bF=true;bA.push(bE(bK)+"")}break;case 8:bA.push("\n");bA.push(new Array(by+1).join(" "));bA.push("<!--");bA.push(bx.data);bA.push("-->");break}}by--;if(!bF){bA.push("\n");for(var bC=0;bC<by;bC++){bA.push(" ")}}bA.push("</");bA.push(bz.nodeName);bA.push(">")}else{bA.push("/>")}}return bA.join("")};this.embedImage=function(bx,by){$(new Image()).load(function(){var bz=document.createElement("canvas");bz.width=this.width;bz.height=this.height;bz.getContext("2d").drawImage(this,0,0);try{var bA=";svgedit_url="+encodeURIComponent(bx);bA=bz.toDataURL().replace(";base64",bA+";base64");bb[bx]=bA}catch(bB){bb[bx]=false}ag=bx;if(by){by(bb[bx])}}).attr("src",bx)};this.setGoodImage=function(bx){ag=bx};this.open=function(){};this.save=function(bx){be();if(bx){$.extend(al,bx)}al.apply=true;var by=i();call("saved",by)};this.rasterExport=function(){be();var by=[];var bx={feGaussianBlur:aJ.exportNoBlur,foreignObject:aJ.exportNoforeignObject,"[stroke-dasharray]":aJ.exportNoDashArray};var bz=$(am);if(!("font" in $("<canvas>")[0].getContext("2d"))){bx.text=aJ.exportNoText}$.each(bx,function(bB,bC){if(bz.find(bB).length){by.push(bC)}});var bA=i();call("exported",{svg:bA,issues:by})};this.getSvgString=function(){al.apply=false;return i()};this.randomizeIds=function(){if(arguments.length>0&&arguments[0]==false){q=false;if(e.Arrows){call("unsetarrownonce")}}else{q=true;if(!am.getAttributeNS(at,"nonce")){am.setAttributeNS(at,"se:nonce",m);if(e.Arrows){call("setarrownonce",m)}}}};var a5=this.uniquifyElems=function(bE){var by={};aB(bE,function(bK){if(bK.nodeType==1){if(bK.id){if(!(bK.id in by)){by[bK.id]={elem:null,attrs:[],hrefs:[]}}by[bK.id]["elem"]=bK}$.each(["clip-path","fill","filter","marker-end","marker-mid","marker-start","mask","stroke"],function(bN,bL){var bP=bK.getAttributeNode(bL);if(bP){var bM=ar(bP.value),bO=bM?bM.substr(1):null;if(bO){if(!(bO in by)){by[bO]={elem:null,attrs:[],hrefs:[]}}by[bO]["attrs"].push(bP)}}});var bI=bk(bK);if(bI&&$.inArray(bK.nodeName,["filter","linearGradient","pattern","radialGradient","textPath","use"])!=-1){var bJ=bI.substr(1);if(!(bJ in by)){by[bJ]={elem:null,attrs:[],hrefs:[]}}by[bJ]["hrefs"].push(bK)}}});for(var bx in by){var bB=by[bx]["elem"];if(bB){var bA=bo();bl++;bB.id=bA;var bH=by[bx]["attrs"];var bD=bH.length;while(bD--){var bF=bH[bD];bF.ownerElement.setAttribute(bF.name,"url(#"+bA+")")}var bG=by[bx]["hrefs"];var bC=bG.length;while(bC--){var bz=bG[bC];a2(bz,"#"+bA)}}}bl++};var a4=this.convertGradients=function(by){var bx=$(by).find("linearGradient, radialGradient");if(!bx.length&&aK){bx=$(by).find("*").filter(function(){return(this.tagName.indexOf("Gradient")!==-1)})}bx.each(function(){var bC=this;if($(bC).attr("gradientUnits")==="userSpaceOnUse"){var bz=$(am).find("[fill=url(#"+bC.id+")],[stroke=url(#"+bC.id+")]");if(!bz.length){return}var bB=bz[0].getBBox();if(bC.tagName==="linearGradient"){var bA=$(bC).attr(["x1","y1","x2","y2"]);$(bC).attr({x1:(bA.x1-bB.x)/bB.width,y1:(bA.y1-bB.y)/bB.height,x2:(bA.x2-bB.x)/bB.width,y2:(bA.y2-bB.y)/bB.height});bC.removeAttribute("gradientUnits")}else{}}})};var r=this.convertToGroup=function(by){if(!by){by=a3[0]}var bx=$(by);var bz=new aI();var bG;if(bx.data("gsvg")){var bC=by.firstChild;var bL=$(bC).attr(["x","y"]);$(by.firstChild.firstChild).unwrap();$(by).removeData("gsvg");var bE=a0(by);var bH=I.createSVGTransform();bH.setTranslate(bL.x,bL.y);bE.appendItem(bH);l(by);call("selected",[by])}else{if(bx.data("symbol")){by=bx.data("symbol");bG=bx.attr("transform");var bJ=bx.attr(["x","y"]);bG+="translate("+bJ.x+","+bJ.y+")";var bA=bx.prev();bz.addSubCommand(new T(bx[0],bx[0].parentNode));bx.remove();var bI=$(am).find("use:data(symbol)").length;var bD=aV.createElementNS(aT,"g");var bF=by.childNodes;for(var bB=0;bB<bF.length;bB++){bD.appendChild(bF[bB].cloneNode(true))}if(bG){bD.setAttribute("transform",bG)}var bK=by.parentNode;a5(bD);bD.id=bo();bA.after(bD);if(bK){if(!bI){bK.removeChild(by);bz.addSubCommand(new T(by,bK))}bz.addSubCommand(new a(bD))}a4(bD);bq(bD,function(bN){try{l(bN)}catch(bM){console.log(bM)}});$(bD).find(aN).each(function(){if(!this.id){this.id=bo()}});ax([bD]);bt.ungroupSelectedElement();bt.groupSelectedElements();a7(bz)}else{console.log("Unexpected element to ungroup:",by)}}};this.setSvgString=function(bD){try{var bG=aE.text2xml(bD);O(bG.documentElement);var by=new aI("Change Source");var bC=I.removeChild(am);by.addSubCommand(new T(bC,I));am=I.appendChild(aV.importNode(bG.documentElement,true));var bA=$(am);n=am.getAttributeNS(at,"nonce");if(n){q=true;m=n;if(e.Arrows){call("setarrownonce",n)}}else{if(q){am.setAttributeNS(bw,"xmlns:se",at);am.setAttributeNS(at,"se:nonce",m);if(e.Arrows){call("setarrownonce",m)}}}bA.find("image").each(function(){var bK=this;a9(bK);var bL=bk(this);if(bL.indexOf("data:")===0){var bI=bL.match(/svgedit_url=(.*?);/);if(bI){var bJ=decodeURIComponent(bI[1]);$(new Image()).load(function(){bK.setAttributeNS(aM,"xlink:href",bJ)}).attr("src",bJ)}}bt.embedImage(bL)});bA.find("svg").each(function(){if($(this).closest("defs").length){return}a5(this);var bI=this.parentNode;if(bI.childNodes.length===1&&bI.nodeName==="g"){$(bI).data("gsvg",this);bI.id=bI.id||bo()}else{s(this)}});bA.find("use").each(function(){var bJ=bk(this).substr(1);var bI=b(bJ);$(this).data("ref",bI);if(bI.tagName=="symbol"||bI.tagName=="svg"){$(this).data("symbol",bI)}});a4(bA[0]);bq(am,function(bJ){try{l(bJ)}catch(bI){console.log(bI)}});var bH={id:"svgcontent",overflow:L.show_outside_canvas?"visible":"hidden"};var bx=false;if(bA.attr("viewBox")){var bE=bA.attr("viewBox").split(" ");bH.width=bE[2];bH.height=bE[3]}else{$.each(["width","height"],function(bI,bJ){var bK=bA.attr(bJ);if(!bK){bK="100%"}if((bK+"").substr(-1)==="%"){bx=true}else{bH[bJ]=bi(bJ,bK)}})}aa();bA.children().find(aN).each(function(){if(!this.id){this.id=bo()}});if(bx){var bB=aj();bH.width=bB.width+bB.x;bH.height=bB.height+bB.y}if(bH.width<=0){bH.width=100}if(bH.height<=0){bH.height=100}bA.attr(bH);this.contentW=bH.width;this.contentH=bH.height;by.addSubCommand(new a(am));var bF=bA.attr(["width","height"]);by.addSubCommand(new aD(I,bF));af=1;V={};be();B.clearData();I.appendChild(H.selectorParentGroup);a7(by);call("changed",[am])}catch(bz){console.log(bz);return false}return true};this.importSvgString=function(bH){try{var bL=aE.text2xml(bH);O(bL.documentElement);var bA=new aI("Change Source");var bE=aV.importNode(bL.documentElement,true);var by=bi("width",bE.getAttribute("width")),bK=bi("height",bE.getAttribute("height")),bz=bE.getAttribute("viewBox"),bI=bz?bz.split(" "):[0,0,by,bK];for(var bD=0;bD<4;++bD){bI[bD]=Number(bI[bD])}var bx=Number(am.getAttribute("width")),bJ=Number(am.getAttribute("height"));if(bK>by){var bG="scale("+(bJ/3)/bI[3]+")"}else{var bG="scale("+(bJ/3)/bI[2]+")"}bG="translate(0) "+bG+" translate(0)";var bB=bE;bB.id=bo();var bC=aV.createElementNS(aT,"use");a2(bC,"#"+bB.id);aL().appendChild(bB);(ao||X).appendChild(bC);bC.id=bo();be();bC.setAttribute("transform",bG);l(bC);$(bC).data("symbol",bB);bm([bC]);return true}catch(bF){console.log(bF);return false}return true};var aa=function(){a6=[];bf();var bF=am.childNodes.length;var bz=[],bG=[];for(var bC=0;bC<bF;++bC){var by=am.childNodes.item(bC);if(by&&by.nodeType==1){if(by.tagName=="g"){var bx=$("title",by).text();if(!bx&&k&&by.querySelectorAll){bx=$(by.querySelectorAll("title")).text()}if(bx){bG.push(bx);a6.push([bx,by]);X=by;aB(by,function(bH){bH.setAttribute("style","pointer-events:inherit")});X.setAttribute("style","pointer-events:none")}else{bz.push(by)}}else{if(aC(by)&&by.nodeName!="defs"){var bE=aC(by);bz.push(by)}}}}if(bz.length>0){var bC=1;while($.inArray(("Layer "+bC),bG)!=-1){bC++}var bA="Layer "+bC;X=aV.createElementNS(aT,"g");var bD=aV.createElementNS(aT,"title");bD.textContent=bA;X.appendChild(bD);for(var bB=0;bB<bz.length;++bB){X.appendChild(bz[bB])}X=am.appendChild(X);a6.push([bA,X])}aB(X,function(bH){bH.setAttribute("style","pointer-events:inherit")});X.setAttribute("style","pointer-events:all")};this.createLayer=function(bz){var by=new aI("Create Layer");var bx=aV.createElementNS(aT,"g");var bA=aV.createElementNS(aT,"title");bA.textContent=bz;bx.appendChild(bA);bx=am.appendChild(bx);by.addSubCommand(new a(bx));a7(by);be();aa();bt.setCurrentLayer(bz);call("changed",[bx])};this.cloneLayer=function(bz){var by=new aI("Duplicate Layer");var bx=aV.createElementNS(aT,"g");var bC=aV.createElementNS(aT,"title");bC.textContent=bz;bx.appendChild(bC);$(X).after(bx);var bD=X.childNodes;for(var bA=0;bA<bD.length;bA++){var bB=bD[bA];if(bB.localName=="title"){continue}bx.appendChild(ay(bB))}be();aa();by.addSubCommand(new a(bx));a7(by);bt.setCurrentLayer(bz);call("changed",[bx])};this.deleteCurrentLayer=function(){if(X&&a6.length>1){var bx=new aI("Delete Layer");var by=X.parentNode;bx.addSubCommand(new T(X,by));by.removeChild(X);a7(bx);be();aa();bt.setCurrentLayer(a6[a6.length-1][0]);call("changed",[am]);return true}return false};this.hasLayer=function(bx){for(var by=0;by<a6.length;by++){if(a6[by][0]==bx){return true}}return false};this.getNumLayers=function(){return a6.length};this.getLayer=function(bx){if(bx>=0&&bx<bt.getNumLayers()){return a6[bx][0]}return""};this.getCurrentLayer=function(){for(var bx=0;bx<a6.length;++bx){if(a6[bx][1]==X){return a6[bx][0]}}return""};this.setCurrentLayer=function(bx){bx=aE.toXml(bx);for(var by=0;by<a6.length;++by){if(bx==a6[by][0]){if(X!=a6[by][1]){be();X.setAttribute("style","pointer-events:none");X=a6[by][1];X.setAttribute("style","pointer-events:all")}return true}}return false};this.renameCurrentLayer=function(bB){if(X){var by=X;if(!bt.setCurrentLayer(bB)){var bz=new aI("Rename Layer");for(var bA=0;bA<a6.length;++bA){if(a6[bA][1]==by){break}}var bC=a6[bA][0];a6[bA][0]=aE.toXml(bB);var bx=by.childNodes.length;for(var bA=0;bA<bx;++bA){var bD=by.childNodes.item(bA);if(bD&&bD.tagName=="title"){while(bD.firstChild){bD.removeChild(bD.firstChild)}bD.textContent=bB;bz.addSubCommand(new aD(bD,{"#text":bC}));a7(bz);call("changed",[by]);return true}}}X=by}return false};this.setCurrentLayerPosition=function(bz){if(X&&bz>=0&&bz<a6.length){for(var bx=0;bx<a6.length;++bx){if(a6[bx][1]==X){break}}if(bx==a6.length){return false}if(bx!=bz){var bA=null;var by=X.nextSibling;if(bz>bx){if(bz<a6.length-1){bA=a6[bz+1][1]}}else{bA=a6[bz][1]}am.insertBefore(X,bA);a7(new U(X,by,am));aa();bt.setCurrentLayer(a6[bz][0]);return true}}return false};this.getLayerVisibility=function(bz){var by=null;for(var bx=0;bx<a6.length;++bx){if(a6[bx][0]==bz){by=a6[bx][1];break}}if(!by){return false}return(by.getAttribute("display")!="none")};this.setLayerVisibility=function(bA,bx){var bz=null;for(var by=0;by<a6.length;++by){if(a6[by][0]==bA){bz=a6[by][1];break}}if(!bz){return false}var bB=bz.getAttribute("display");if(!bB){bB="inline"}bz.setAttribute("display",bx?"inline":"none");a7(new aD(bz,{display:bB},"Layer Visibility"));if(bz==X){be();B.clear()}return true};this.moveSelectedToLayer=function(bD){var bB=null;for(var bA=0;bA<a6.length;++bA){if(a6[bA][0]==bD){bB=a6[bA][1];break}}if(!bB){return false}var bz=new aI("Move Elements to Layer");var by=a3;var bA=by.length;while(bA--){var bC=by[bA];if(!bC){continue}var bE=bC.nextSibling;var bx=bC.parentNode;bB.appendChild(bC);bz.addSubCommand(new U(bC,bE,bx))}a7(bz);return true};this.mergeLayer=function(bD){var by=new aI("Merge Layer");var bA=$(X).prev()[0];if(!bA){return}var bB=X.childNodes;var bx=bB.length;by.addSubCommand(new T(X,am));while(X.firstChild){var bz=X.firstChild;if(bz.localName=="title"){by.addSubCommand(new T(bz,X));X.removeChild(bz);continue}var bC=bz.nextSibling;bA.appendChild(bz);by.addSubCommand(new U(bz,bC,X))}am.removeChild(X);if(!bD){be();aa();call("changed",[am]);a7(by)}X=bA;return by};this.mergeAllLayers=function(){var bx=new aI("Merge all Layers");X=a6[a6.length-1][1];while($(am).children("g").length>1){bx.addSubCommand(bt.mergeLayer(true))}be();aa();call("changed",[am]);a7(bx)};this.getLayerOpacity=function(bA){for(var by=0;by<a6.length;++by){if(a6[by][0]==bA){var bz=a6[by][1];var bx=bz.getAttribute("opacity");if(!bx){bx="1.0"}return parseFloat(bx)}}return null};this.setLayerOpacity=function(bA,bx){if(bx<0||bx>1){return}for(var by=0;by<a6.length;++by){if(a6[by][0]==bA){var bz=a6[by][1];bz.setAttribute("opacity",bx);break}}};var bf=this.leaveContext=function(){var bx=ae.length;if(bx){for(var by=0;by<bx;by++){var bz=ae[by];var bA=a1(bz,"orig_opac");if(bA!==1){bz.setAttribute("opacity",bA)}else{bz.removeAttribute("opacity")}bz.setAttribute("style","pointer-events: inherit")}ae=[];be(true);call("contextset",null)}ao=null};var aX=this.setContext=function(bx){bf();if(typeof bx==="string"){bx=b(bx)}ao=bx;$(bx).parentsUntil("#svgcontent").andSelf().siblings().each(function(){var by=this.getAttribute("opacity")||1;a1(this,"orig_opac",by);this.setAttribute("opacity",by*0.33);this.setAttribute("style","pointer-events: none");ae.push(this)});be();call("contextset",ao)};this.clear=function(){B.clear();var by=am.childNodes;var bx=am.childNodes.length;var bz=0;be();for(var bA=0;bA<bx;bA++){if(by[bz].nodeType==1){am.removeChild(by[bz])}else{bz++}}a6=[];bt.createLayer("Layer 1");bt.undoMgr.resetUndoStack();H.initGroup();j=H.getRubberBandBox();call("cleared")};this.linkControlPoints=B.linkControlPoints;this.getContentElem=function(){return am};this.getRootElem=function(){return I};this.getSelectedElems=function(){return a3};var d=this.getResolution=function(){return{w:am.getAttribute("width")/af,h:am.getAttribute("height")/af,zoom:af}};this.getZoom=function(){return af};this.getVersion=function(){return"svgcanvas.js ($Rev: 1765 $)"};this.setUiStrings=function(bx){$.extend(aJ,bx)};this.setConfig=function(bx){$.extend(L,bx)};this.getTitle=function(by){by=by||a3[0];if(!by){return}by=$(by).data("gsvg")||$(by).data("symbol")||by;var bz=by.childNodes;for(var bx=0;bx<bz.length;bx++){if(bz[bx].nodeName=="title"){return bz[bx].textContent}}return""};var bk=this.getHref=function(bx){return bx.getAttributeNS(aM,"href")};var a2=this.setHref=function(bx,by){bx.setAttributeNS(aM,"xlink:href",by)};this.setGroupTitle=function(bB){var bz=a3[0];bz=$(bz).data("gsvg")||bz;var by=$(bz).children("title");var bx=new aI("Set Label");if(!bB.length){bx.addSubCommand(new T(by[0],bz));by.remove()}else{if(by.length){var bA=by[0];bx.addSubCommand(new aD(bA,{"#text":bA.textContent}));bA.textContent=bB}else{bA=aV.createElementNS(aT,"title");bA.textContent=bB;$(bz).prepend(bA);bx.addSubCommand(new a(bA))}}a7(bx)};this.getDocumentTitle=function(){return bt.getTitle(am)};this.setDocumentTitle=function(bA){var bB=am.childNodes,bC=false,bz="";var bx=new aI("Change Image Title");for(var by=0;by<bB.length;by++){if(bB[by].nodeName=="title"){bC=bB[by];bz=bC.textContent;break}}if(!bC){bC=aV.createElementNS(aT,"title");am.insertBefore(bC,am.firstChild)}if(bA.length){bC.textContent=bA}else{bC.parentNode.removeChild(bC)}bx.addSubCommand(new aD(bC,{"#text":bz}));a7(bx)};this.getEditorNS=function(bx){if(bx){am.setAttribute("xmlns:se",at)}return at};this.setResolution=function(bE,bD){var bC=d();var bF=bC.w,bz=bC.h;var by;if(bE=="fit"){var bG=aj();if(bG){by=new aI("Fit Canvas to Content");var bA=aY();bm(bA);var bI=[],bH=[];$.each(bA,function(bJ,bK){bI.push(bG.x*-1);bH.push(bG.y*-1)});var bx=bt.moveSelectedElements(bI,bH,true);by.addSubCommand(bx);be();bE=Math.round(bG.width);bD=Math.round(bG.height)}else{return false}}if(bE!=bF||bD!=bz){var bB=I.suspendRedraw(1000);if(!by){by=new aI("Change Image Dimensions")}bE=bi("width",bE);bD=bi("height",bD);am.setAttribute("width",bE);am.setAttribute("height",bD);this.contentW=bE;this.contentH=bD;by.addSubCommand(new aD(am,{width:bF,height:bz}));am.setAttribute("viewBox",[0,0,bE/af,bD/af].join(" "));by.addSubCommand(new aD(am,{viewBox:["0 0",bF,bz].join(" ")}));a7(by);I.unsuspendRedraw(bB);call("changed",[am])}return true};this.getOffset=function(){return $(am).attr(["x","y"])};this.setBBoxZoom=function(by,bF,bz){var bE=0.85;var bD;var bB=function(bJ){if(!bJ){return false}var bI=Math.round((bF/bJ.width)*100*bE)/100;var bG=Math.round((bz/bJ.height)*100*bE)/100;var bH=Math.min(bI,bG);bt.setZoom(bH);return{zoom:bH,bbox:bJ}};if(typeof by=="object"){bD=by;if(bD.width==0||bD.height==0){var bx=bD.zoom?bD.zoom:af*bD.factor;bt.setZoom(bx);return{zoom:af,bbox:bD}}return bB(bD)}switch(by){case"selection":if(!a3[0]){return}var bA=$.map(a3,function(bG){if(bG){return bG}});bD=aj(bA);break;case"canvas":var bC=d();bE=0.95;bD={width:bC.w,height:bC.h,x:0,y:0};break;case"content":bD=aj();break;case"layer":bD=aj(aY(X));break;default:return}return bB(bD)};this.setZoom=function(bx){var by=d();am.setAttribute("viewBox","0 0 "+by.w/bx+" "+by.h/bx);af=bx;$.each(a3,function(bz,bA){if(!bA){return}H.requestSelector(bA).resize()});B.zoomChange();aR("zoomChanged",bx)};this.getMode=function(){return bh};this.setMode=function(bx){B.clear(true);N.clear();t=(a3[0]&&a3[0].nodeName=="text")?bn:aW;bh=bx};this.getColor=function(bx){return t[bx]};this.setColor=function(bA,bC,by){aW[bA]=bC;t[bA+"_paint"]={type:"solidColor"};var bx=[];var bz=a3.length;while(bz--){var bB=a3[bz];if(bB){if(bB.tagName=="g"){aB(bB,function(bD){if(bD.nodeName!="g"){bx.push(bD)}})}else{if(bA=="fill"){if(bB.tagName!="polyline"&&bB.tagName!="line"){bx.push(bB)}}else{bx.push(bB)}}}}if(bx.length>0){if(!by){C(bA,bC,bx);call("changed",bx)}else{o(bA,bC,bx)}}};var aL=function(){var bx=am.getElementsByTagNameNS(aT,"defs");if(bx.length>0){bx=bx[0]}else{bx=am.insertBefore(aV.createElementNS(aT,"defs"),am.firstChild.nextSibling)}return bx};var ah=this.setGradient=function(by){if(!t[by+"_paint"]||t[by+"_paint"].type=="solidColor"){return}var bB=bt[by+"Grad"];var bA=v(bB);var bx=aL();if(!bA){var bz=bB;bB=bx.appendChild(aV.importNode(bB,true));bB.id=bo()}else{bB=bA}bt.setColor(by,"url(#"+bB.id+")")};var v=function(bF){var bB=aL();var bH=$(bB).find("linearGradient, radialGradient");var bC=bH.length;var by=["r","cx","cy","fx","fy"];while(bC--){var bJ=bH[bC];if(bF.tagName=="linearGradient"){if(bF.getAttribute("x1")!=bJ.getAttribute("x1")||bF.getAttribute("y1")!=bJ.getAttribute("y1")||bF.getAttribute("x2")!=bJ.getAttribute("x2")||bF.getAttribute("y2")!=bJ.getAttribute("y2")){continue}}else{var bz=$(bF).attr(by);var bG=$(bJ).attr(by);var bE=false;$.each(by,function(bM,bL){if(bz[bL]!=bG[bL]){bE=true}});if(bE){continue}}var bI=bF.getElementsByTagNameNS(aT,"stop");var bK=bJ.getElementsByTagNameNS(aT,"stop");if(bI.length!=bK.length){continue}var bA=bI.length;while(bA--){var bD=bI[bA];var bx=bK[bA];if(bD.getAttribute("offset")!=bx.getAttribute("offset")||bD.getAttribute("stop-opacity")!=bx.getAttribute("stop-opacity")||bD.getAttribute("stop-color")!=bx.getAttribute("stop-color")){break}}if(bA==-1){return bJ}}return null};this.setPaint=function(bx,bz){var by=new $.jGraduate.Paint(bz);this.setPaintOpacity(bx,by.alpha/100,true);t[bx+"_paint"]=by;switch(by.type){case"solidColor":this.setColor(bx,by.solidColor!="none"?"#"+by.solidColor:"none");break;case"linearGradient":case"radialGradient":bt[bx+"Grad"]=by[by.type];ah(bx);break;default:}};this.getStrokeWidth=function(){return t.stroke_width};this.setStrokeWidth=function(bA){if(bA==0&&$.inArray(bh,["line","path"])!=-1){bt.setStrokeWidth(1);return}t.stroke_width=bA;var bx=[];var by=a3.length;while(by--){var bz=a3[by];if(bz){if(bz.tagName=="g"){aB(bz,function(bB){if(bB.nodeName!="g"){bx.push(bB)}})}else{bx.push(bz)}}}if(bx.length>0){C("stroke-width",bA,bx);call("changed",a3)}};this.setStrokeAttr=function(bx,bB){aW[bx.replace("-","_")]=bB;var by=[];var bz=a3.length;while(bz--){var bA=a3[bz];if(bA){if(bA.tagName=="g"){aB(bA,function(bC){if(bC.nodeName!="g"){by.push(bC)}})}else{by.push(bA)}}}if(by.length>0){C(bx,bB,by);call("changed",a3)}};this.getStyle=function(){return aW};this.getOpacity=function(){return aW.opacity};this.setOpacity=function(bx){aW.opacity=bx;C("opacity",bx)};this.getFillOpacity=function(){return aW.fill_opacity};this.getStrokeOpacity=function(){return aW.stroke_opacity};this.setPaintOpacity=function(by,bz,bx){aW[by+"_opacity"]=bz;if(!bx){C(by+"-opacity",bz)}else{o(by+"-opacity",bz)}};this.getBlur=function(bx){var bA=0;if(bx){var by=bx.getAttribute("filter");if(by){var bz=b(bx.id+"_blur");if(bz){bA=bz.firstChild.getAttribute("stdDeviation")}}}return bA};(function(){var bz=null;var bA=null;var bx=false;bt.setBlurNoUndo=function(bB){if(!bA){bt.setBlur(bB);return}if(bB===0){o("filter","");bx=true}else{if(bx){o("filter","url(#"+a3[0].id+"_blur)")}o("stdDeviation",bB,[bA.firstChild]);bt.setBlurOffsets(bA,bB)}};function by(){var bB=bt.finishUndoableChange();bz.addSubCommand(bB);a7(bz);bz=null;bA=null}bt.setBlurOffsets=function(bB,bC){if(bC>3){aH(bB,{x:"-50%",y:"-50%",width:"200%",height:"200%",},100)}else{bB.removeAttribute("x");bB.removeAttribute("y");bB.removeAttribute("width");bB.removeAttribute("height")}};bt.setBlur=function(bG,bC){if(bz){by();return}var bF=a3[0];var bB=bF.id;bA=b(bB+"_blur");bG-=0;var bD=new aI();if(bA){if(bG===0){bA=null}}else{var bH=c({element:"feGaussianBlur",attr:{"in":"SourceGraphic",stdDeviation:bG}});bA=c({element:"filter",attr:{id:bB+"_blur"}});bA.appendChild(bH);aL().appendChild(bA);bD.addSubCommand(new a(bA))}var bE={filter:bF.getAttribute("filter")};if(bG===0){bF.removeAttribute("filter");bD.addSubCommand(new aD(bF,bE));return}else{C("filter","url(#"+bB+"_blur)");bD.addSubCommand(new aD(bF,bE));bt.setBlurOffsets(bA,bG)}bz=bD;bt.beginUndoableChange("stdDeviation",[bA?bA.firstChild:null]);if(bC){bt.setBlurNoUndo(bG);by()}}}());this.getBold=function(){var bx=a3[0];if(bx!=null&&bx.tagName=="text"&&a3[1]==null){return(bx.getAttribute("font-weight")=="bold")}return false};this.setBold=function(bx){var by=a3[0];if(by!=null&&by.tagName=="text"&&a3[1]==null){C("font-weight",bx?"bold":"normal")}if(!a3[0].textContent){N.setCursor()}};this.getItalic=function(){var bx=a3[0];if(bx!=null&&bx.tagName=="text"&&a3[1]==null){return(bx.getAttribute("font-style")=="italic")}return false};this.setItalic=function(bx){var by=a3[0];if(by!=null&&by.tagName=="text"&&a3[1]==null){C("font-style",bx?"italic":"normal")}if(!a3[0].textContent){N.setCursor()}};this.getFontFamily=function(){return bn.font_family};this.setFontFamily=function(bx){bn.font_family=bx;C("font-family",bx);if(a3[0]&&!a3[0].textContent){N.setCursor()}};this.getFontSize=function(){return bn.font_size};this.setFontSize=function(bx){bn.font_size=bx;C("font-size",bx);if(!a3[0].textContent){N.setCursor()}};this.getText=function(){var bx=a3[0];if(bx==null){return""}return bx.textContent};this.setTextContent=function(bx){C("#text",bx);N.init(bx);N.setCursor()};this.setImageURL=function(bC){var bB=a3[0];if(!bB){return}var bz=$(bB).attr(["width","height"]);var bx=(!bz.width||!bz.height);var bA=bk(bB);if(bA!==bC){bx=true}else{if(!bx){return}}var by=new aI("Change Image URL");a2(bB,bC);by.addSubCommand(new aD(bB,{"#href":bA}));if(bx){$(new Image()).load(function(){var bD=$(bB).attr(["width","height"]);$(bB).attr({width:this.width,height:this.height});H.requestSelector(bB).resize();by.addSubCommand(new aD(bB,bD));a7(by);call("changed",[bB])}).attr("src",bC)}else{a7(by)}};this.setRectRadius=function(bz){var bx=a3[0];if(bx!=null&&bx.tagName=="rect"){var by=bx.getAttribute("rx");if(by!=bz){bx.setAttribute("rx",bz);bx.setAttribute("ry",bz);a7(new aD(bx,{rx:by,ry:by},"Radius"));call("changed",[bx])}}};this.setSegType=function(bx){B.setSegType(bx)};this.convertToPath=function(bQ,bR){if(bQ==null){var bW=a3;$.each(a3,function(bX,bY){if(bY){bt.convertToPath(bY)}});return}if(!bR){var bJ=new aI("Convert element to Path")}var bN=bR?{}:{fill:aW.fill,"fill-opacity":aW.fill_opacity,stroke:aW.stroke,"stroke-width":aW.stroke_width,"stroke-dasharray":aW.stroke_dasharray,"stroke-linejoin":aW.stroke_linejoin,"stroke-linecap":aW.stroke_linecap,"stroke-opacity":aW.stroke_opacity,opacity:aW.opacity,visibility:"hidden"};$.each(["marker-start","marker-end","marker-mid","filter","clip-path"],function(){if(bQ.getAttribute(this)){bN[this]=bQ.getAttribute(this)}});var bL=c({element:"path",attr:bN});var bU=bQ.getAttribute("transform");if(bU){bL.setAttribute("transform",bU)}var bM=bQ.id;var bG=bQ.parentNode;if(bQ.nextSibling){bG.insertBefore(bL,bQ)}else{bG.appendChild(bL)}var bS="";var bC=function(bX){$.each(bX,function(b0,bZ){var bY=bZ[0],b2=bZ[1];bS+=bY;for(var b1=0;b1<b2.length;b1+=2){bS+=(b2[b1]+","+b2[b1+1])+" "}})};var bD=1.81;switch(bQ.tagName){case"ellipse":case"circle":var bV=$(bQ).attr(["rx","ry","cx","cy"]);var by=bV.cx,bx=bV.cy,bA=bV.rx,bz=bV.ry;if(bQ.tagName=="circle"){bA=bz=$(bQ).attr("r")}bC([["M",[(by-bA),(bx)]],["C",[(by-bA),(bx-bz/bD),(by-bA/bD),(bx-bz),(by),(bx-bz)]],["C",[(by+bA/bD),(bx-bz),(by+bA),(bx-bz/bD),(by+bA),(bx)]],["C",[(by+bA),(bx+bz/bD),(by+bA/bD),(bx+bz),(by),(bx+bz)]],["C",[(by-bA/bD),(bx+bz),(by-bA),(bx+bz/bD),(by-bA),(bx)]],["Z",[]]]);break;case"path":bS=bQ.getAttribute("d");break;case"line":var bV=$(bQ).attr(["x1","y1","x2","y2"]);bS="M"+bV.x1+","+bV.y1+"L"+bV.x2+","+bV.y2;break;case"polyline":case"polygon":bS="M"+bQ.getAttribute("points");break;case"rect":var bK=$(bQ).attr(["rx","ry"]);var bA=bK.rx,bz=bK.ry;var bT=bQ.getBBox();var bH=bT.x,bF=bT.y,bI=bT.width,bO=bT.height;var bD=4-bD;if(!bA&&!bz){bC([["M",[bH,bF]],["L",[bH+bI,bF]],["L",[bH+bI,bF+bO]],["L",[bH,bF+bO]],["L",[bH,bF]],["Z",[]]])}else{bC([["M",[bH,bF+bz]],["C",[bH,bF+bz/bD,bH+bA/bD,bF,bH+bA,bF]],["L",[bH+bI-bA,bF]],["C",[bH+bI-bA/bD,bF,bH+bI,bF+bz/bD,bH+bI,bF+bz]],["L",[bH+bI,bF+bO-bz]],["C",[bH+bI,bF+bO-bz/bD,bH+bI-bA/bD,bF+bO,bH+bI-bA,bF+bO]],["L",[bH+bA,bF+bO]],["C",[bH+bA/bD,bF+bO,bH,bF+bO-bz/bD,bH,bF+bO-bz]],["L",[bH,bF+bz]],["Z",[]]])}break;default:bL.parentNode.removeChild(bL);break}if(bS){bL.setAttribute("d",bS)}if(!bR){if(bU){var bE=a0(bL);if(aZ(bE)){B.resetOrientation(bL)}}bJ.addSubCommand(new T(bQ,bG));bJ.addSubCommand(new a(bL));be();bQ.parentNode.removeChild(bQ);bL.setAttribute("id",bM);bL.removeAttribute("visibility");bm([bL],true);a7(bJ)}else{B.resetOrientation(bL);var bB=false;try{bB=bL.getBBox()}catch(bP){}bL.parentNode.removeChild(bL);return bB}};var o=function(bI,bG,bQ){var bN=I.suspendRedraw(1000);if(bh=="pathedit"){B.moveNode(bI,bG)}var bQ=bQ||a3;var bK=bQ.length;while(bK--){var bM=bQ[bK];if(bM==null){continue}if(bh==="textedit"&&bI!=="#text"&&bM.textContent.length){N.toSelectMode(bM)}if((bI=="x"||bI=="y")&&$.inArray(bM.tagName,["g","polyline","path"])!=-1){var bx=aj([bM]);var bD=bI=="x"?bG-bx.x:0;var bC=bI=="y"?bG-bx.y:0;bt.moveSelectedElements(bD*af,bC*af,true);continue}if(bM.tagName=="g"&&$.inArray(bI,["transform","opacity","filter"])!==-1){}var bB=bI=="#text"?bM.textContent:bM.getAttribute(bI);if(bB==null){bB=""}if(bB!=String(bG)){if(bI=="#text"){var bJ=aC(bM).width;bM.textContent=bG;bM=g(bM)}else{if(bI=="#href"){a2(bM,bG)}else{bM.setAttribute(bI,bG)}}if(bK==0){w[bK]=aC(bM)}if(bM.nodeName=="text"){if((bG+"").indexOf("url")==0||$.inArray(bI,["font-size","font-family","x","y"])!=-1&&bM.textContent){bM=g(bM)}}if($.inArray(bM,a3)!=-1){setTimeout(function(){if(!bM.parentNode){return}H.requestSelector(bM).resize()},0)}var bL=az(bM);if(bL!=0&&bI!="transform"){var bE=a0(bM);var bH=bE.numberOfItems;while(bH--){var bz=bE.getItem(bH);if(bz.type==4){bE.removeItem(bH);var bF=aC(bM);var bP=R(bF.x+bF.width/2,bF.y+bF.height/2,u(bE).matrix);var bA=bP.x,by=bP.y;var bO=I.createSVGTransform();bO.setRotate(bL,bA,by);bE.insertItemBefore(bO,bH);break}}}}}I.unsuspendRedraw(bN)};var C=this.changeSelectedAttribute=function(bx,bB,bz){var bz=bz||a3;bt.beginUndoableChange(bx,bz);var bA=bz.length;o(bx,bB,bz);var by=bt.finishUndoableChange();if(!by.isEmpty()){a7(by)}};this.deleteSelectedElements=function(){var bz=new aI("Delete Elements");var by=a3.length;var bx=[];for(var bB=0;bB<by;++bB){var bD=a3[bB];if(bD==null){break}var bC=bD.parentNode;var bA=bD;H.releaseSelector(bA);var bE=bC.removeChild(bA);bx.push(bD);a3[bB]=null;bz.addSubCommand(new T(bE,bC))}if(!bz.isEmpty()){a7(bz)}call("changed",bx);be()};this.cutSelectedElements=function(){var bz=new aI("Cut Elements");var by=a3.length;var bx=[];for(var bB=0;bB<by;++bB){var bD=a3[bB];if(bD==null){break}var bC=bD.parentNode;var bA=bD;H.releaseSelector(bA);var bE=bC.removeChild(bA);bx.push(bD);a3[bB]=null;bz.addSubCommand(new T(bE,bC))}if(!bz.isEmpty()){a7(bz)}call("changed",bx);be();bt.clipBoard=bx};this.copySelectedElements=function(){bt.clipBoard=$.merge([],a3)};this.pasteElements=function(bG){var bC=bt.clipBoard;var bE=bC.length;if(!bE){return}var bF=[];var bA=new aI("Paste elements");while(bE--){var bz=bC[bE];if(!bz){continue}var bx=ay(bz);if(!b(bz.id)){bx.id=bz.id}bF.push(bx);(ao||X).appendChild(bx);bA.addSubCommand(new a(bx))}ax(bF);if(bG!=="in_place"){var bH=aj(bF);var bD=ak.x-(bH.x+bH.width/2),bB=ak.y-(bH.y+bH.height/2),bJ=[],bI=[];$.each(bF,function(bK,bL){bJ.push(bD);bI.push(bB)});var by=bt.moveSelectedElements(bJ,bI,false);bA.addSubCommand(by)}a7(bA);call("changed",bF)};this.groupSelectedElements=function(){var bx=new aI("Group Elements");var bB=c({element:"g",attr:{id:bo()}});bx.addSubCommand(new a(bB));var bz=a3.length;while(bz--){var bA=a3[bz];if(bA==null){continue}var bC=bA.nextSibling;var by=bA.parentNode;bB.appendChild(bA);bx.addSubCommand(new U(bA,bC,by))}if(!bx.isEmpty()){a7(bx)}ax([bB],true)};this.ungroupSelectedElement=function(){var b5=a3[0];if($(b5).data("gsvg")||$(b5).data("symbol")){r(b5);return}if(b5.tagName=="g"){var bx=new aI("Ungroup Elements");var bF=b5.parentNode;var bA=b5.nextSibling;var bM=new Array(b5.childNodes.length);var bZ=b5.getAttribute("transform");var bG=a0(b5);var b1=u(bG).matrix;var b4=0;var bS=az(b5);var bN=$(b5).attr(["filter","opacity"]);var b3,bB;while(b5.firstChild){var b0=b5.firstChild;var bT=b0.nextSibling;var bV=b0.parentNode;if(b0.tagName=="title"){bx.addSubCommand(new T(b0,bV));bV.removeChild(b0);continue}bM[b4++]=b0=bF.insertBefore(b0,bA);bx.addSubCommand(new U(b0,bT,bV));if(bN.opacity!==null&&bN.opacity!==1){var b8=b0.getAttribute("opacity")||1;var bC=Math.round((b0.getAttribute("opacity")||1)*bN.opacity*100)/100;C("opacity",bC,[b0])}if(bN.filter){var bH=this.getBlur(b0);var bL=bH;if(!bB){bB=this.getBlur(b5)}if(bH){bH=(bB-0)+(bH-0)}else{if(bH===0){bH=bB}}if(!bL){if(!b3){b3=b(ar(bN.filter).substr(1))}else{b3=ay(b3);aL().appendChild(b3)}}else{b3=b(ar(b0.getAttribute("filter")).substr(1))}var b2=(b3.firstChild.tagName==="feGaussianBlur")?"blur":"filter";b3.id=b0.id+"_"+b2;C("filter","url(#"+b3.id+")",[b0]);if(bH){C("stdDeviation",bH,[b3.firstChild]);bt.setBlurOffsets(b3,bH)}}var bU=a0(b0);if(~b0.tagName.indexOf("Gradient")){bU=null}if(!bU){continue}if(bG.numberOfItems){if(bS&&bG.numberOfItems==1){var by=bG.getItem(0).matrix;var bK=I.createSVGMatrix();var bR=az(b0);if(bR){bK=bU.getItem(0).matrix}var bY=aC(b0);var b6=u(bU).matrix;var bJ=R(bY.x+bY.width/2,bY.y+bY.height/2,b6);var bW=bS+bR;var bI=I.createSVGTransform();bI.setRotate(bW,bJ.x,bJ.y);var bD=ai(by,bK,bI.matrix.inverse());if(bR){bU.removeItem(0)}if(bW){if(bU.numberOfItems){bU.insertItemBefore(bI,0)}else{bU.appendItem(bI)}}if(bD.e||bD.f){var b7=I.createSVGTransform();b7.setTranslate(bD.e,bD.f);if(bU.numberOfItems){bU.insertItemBefore(b7,0)}else{bU.appendItem(b7)}}}else{var bO=b0.getAttribute("transform");var bP={};bP.transform=bO?bO:"";var bz=I.createSVGTransform();var bQ=u(bU).matrix,bX=bQ.inverse();var bE=ai(bX,b1,bQ);bz.setMatrix(bE);bU.appendItem(bz)}bx.addSubCommand(l(b0))}}if(bZ){var bP={};bP.transform=bZ;b5.setAttribute("transform","");b5.removeAttribute("transform");bx.addSubCommand(new aD(b5,bP))}be();b5=bF.removeChild(b5);bx.addSubCommand(new T(b5,bF));if(!bx.isEmpty()){a7(bx)}bm(bM)}};this.moveToTopSelectedElement=function(){var bz=a3[0];if(bz!=null){var by=bz;var bx=by.parentNode;var bA=by.nextSibling;by=by.parentNode.appendChild(by);a7(new U(by,bA,bx,"top"))}};this.moveToBottomSelectedElement=function(){var bz=a3[0];if(bz!=null){var by=bz;var bx=by.parentNode;var bB=by.nextSibling;var bA=by.parentNode.firstChild;if(bA.tagName=="title"){bA=bA.nextSibling}if(bA.tagName=="defs"){bA=bA.nextSibling}by=by.parentNode.insertBefore(by,bA);a7(new U(by,bB,bx,"bottom"))}};this.moveUpDownSelected=function(bx){var bA=a3[0];if(!bA){return}aQ=[];var bB,bD;var bC=$(ba(aj([bA]))).toArray();if(bx=="Down"){bC.reverse()}$.each(bC,function(){if(!bD){if(this==bA){bD=true}return}bB=this;return false});if(!bB){return}var bz=bA;var by=bz.parentNode;var bE=bz.nextSibling;$(bB)[bx=="Down"?"before":"after"](bz);a7(new U(bz,bE,by,"Move "+bx))};this.moveSelectedElements=function(bH,bG,bD){if(bH.constructor!=Array){bH/=af;bG/=af}var bD=bD||true;var by=new aI("position");var bB=a3.length;while(bB--){var bz=a3[bB];if(bz!=null){if(bB==0){w[bB]=aC(bz)}var bF={};for(var bA in w[bB]){bF[bA]=w[bB][bA]}w[bB]=bF;var bE=I.createSVGTransform();var bC=a0(bz);if(bH.constructor==Array){if(bB==0){w[bB].x+=bH[bB];w[bB].y+=bG[bB]}bE.setTranslate(bH[bB],bG[bB])}else{if(bB==0){w[bB].x+=bH;w[bB].y+=bG}bE.setTranslate(bH,bG)}if(bC.numberOfItems){bC.insertItemBefore(bE,0)}else{bC.appendItem(bE)}var bx=l(bz);if(bx){by.addSubCommand(bx)}H.requestSelector(bz).resize()}}if(!by.isEmpty()){if(bD){a7(by)}call("changed",a3);return by}};this.cloneSelectedElements=function(){var by=new aI("Clone Elements");var bx=a3.length;for(var bz=0;bz<bx;++bz){var bB=a3[bz];if(bB==null){break}}var bA=a3.slice(0,bz);this.clearSelection(true);var bz=bA.length;while(bz--){var bB=bA[bz]=ay(bA[bz]);(ao||X).appendChild(bB);by.addSubCommand(new a(bB))}if(!by.isEmpty()){bm(bA.reverse());this.moveSelectedElements(20,20,false);a7(by)}};this.alignSelectedElements=function(bF,bL){var bA=[],bD=[];var bJ=Number.MAX_VALUE,bE=Number.MIN_VALUE,bH=Number.MAX_VALUE,bC=Number.MIN_VALUE;var bG=Number.MIN_VALUE,bB=Number.MIN_VALUE;var bz=a3.length;if(!bz){return}for(var by=0;by<bz;++by){if(a3[by]==null){break}var bx=a3[by];bA[by]=aj([bx]);switch(bL){case"smallest":if((bF=="l"||bF=="c"||bF=="r")&&(bG==Number.MIN_VALUE||bG>bA[by].width)||(bF=="t"||bF=="m"||bF=="b")&&(bB==Number.MIN_VALUE||bB>bA[by].height)){bJ=bA[by].x;bH=bA[by].y;bE=bA[by].x+bA[by].width;bC=bA[by].y+bA[by].height;bG=bA[by].width;bB=bA[by].height}break;case"largest":if((bF=="l"||bF=="c"||bF=="r")&&(bG==Number.MIN_VALUE||bG<bA[by].width)||(bF=="t"||bF=="m"||bF=="b")&&(bB==Number.MIN_VALUE||bB<bA[by].height)){bJ=bA[by].x;bH=bA[by].y;bE=bA[by].x+bA[by].width;bC=bA[by].y+bA[by].height;bG=bA[by].width;bB=bA[by].height}break;default:if(bA[by].x<bJ){bJ=bA[by].x}if(bA[by].y<bH){bH=bA[by].y}if(bA[by].x+bA[by].width>bE){bE=bA[by].x+bA[by].width}if(bA[by].y+bA[by].height>bC){bC=bA[by].y+bA[by].height}break}}if(bL=="page"){bJ=0;bH=0;bE=bt.contentW;bC=bt.contentH}var bM=new Array(bz);var bK=new Array(bz);for(var by=0;by<bz;++by){if(a3[by]==null){break}var bx=a3[by];var bI=bA[by];bM[by]=0;bK[by]=0;switch(bF){case"l":bM[by]=bJ-bI.x;break;case"c":bM[by]=(bJ+bE)/2-(bI.x+bI.width/2);break;case"r":bM[by]=bE-(bI.x+bI.width);break;case"t":bK[by]=bH-bI.y;break;case"m":bK[by]=(bH+bC)/2-(bI.y+bI.height/2);break;case"b":bK[by]=bC-(bI.y+bI.height);break}}this.moveSelectedElements(bM,bK)};this.contentW=d().w;this.contentH=d().h;this.updateCanvas=function(bz,bB){I.setAttribute("width",bz);I.setAttribute("height",bB);var bA=$("#canvasBackground")[0];var by=am.getAttribute("x");var bD=am.getAttribute("y");var bx=(bz/2-this.contentW*af/2);var bC=(bB/2-this.contentH*af/2);aH(am,{width:this.contentW*af,height:this.contentH*af,x:bx,y:bC,viewBox:"0 0 "+this.contentW+" "+this.contentH});aH(bA,{width:am.getAttribute("width"),height:am.getAttribute("height"),x:bx,y:bC});H.selectorParentGroup.setAttribute("transform","translate("+bx+","+bC+")");return{x:bx,y:bC,old_x:by,old_y:bD,d_x:bx-by,d_y:bC-bD}};this.setBackground=function(bx,bz){var bA=b("canvasBackground");var by=$(bA).find("rect")[0];var bB=b("background_image");by.setAttribute("fill",bx);if(bz){if(!bB){bB=aV.createElementNS(aT,"image");aH(bB,{id:"background_image",width:"100%",height:"100%",preserveAspectRatio:"xMinYMin",style:"pointer-events:none"})}a2(bB,bz);bA.appendChild(bB)}else{if(bB){bB.parentNode.removeChild(bB)}}};this.cycleElement=function(bz){var bC=a3[0];var bA=false;var bB=aY(ao||X);if(!bB.length){return}if(bC==null){var bx=bz?bB.length-1:0;bA=bB[bx]}else{var by=bB.length;while(by--){if(bB[by]==bC){var bx=bz?by-1:by+1;if(bx>=bB.length){bx=0}else{if(bx<0){bx=bB.length-1}}bA=bB[bx];break}}}ax([bA],true);call("selected",a3)};this.clear();this.getPrivateMethods=function(){var bx={addCommandToHistory:a7,setGradient:ah,addSvgElementFromJson:c,assignAttributes:aH,BatchCommand:aI,call:call,ChangeElementCommand:aD,cleanupElement:aA,copyElem:ay,ffClone:g,findDefs:aL,findDuplicateGradient:v,getElem:b,getId:E,getIntersectionList:ba,getMouseTarget:ab,getNextId:bo,getPathBBox:bs,getUrlFromAttr:ar,hasMatrixTransform:aZ,identifyLayers:aa,InsertElementCommand:a,isIdentity:bp,logMatrix:aF,matrixMultiply:ai,MoveElementCommand:U,preventClickDefault:a9,recalculateAllSelectedDimensions:bc,recalculateDimensions:l,remapElement:F,RemoveElementCommand:T,removeUnusedDefElems:z,round:S,runExtensions:aR,sanitizeSvg:O,SelectorManager:bu,shortFloat:bj,svgCanvasToString:i,SVGEditTransformList:J,svgToString:a8,toString:toString,transformBox:bv,transformListToTransform:u,transformPoint:R,walkTree:aB};return bx};function aS(){var bx;var by=$("#text").css({position:"static"});$.each(["mouseDown","mouseUp","mouseMove","setCursor","init","select","toEditMode"],function(){N[this]=$.noop});N.init=function(bz){bx=bz;$(bx).unbind("dblclick").bind("dblclick",function(){by.focus()})};bt.textActions=N}(function(){var bC=document.createElementNS(aT,"path");bC.setAttribute("d","M0,0 10,10");var by=bC.pathSegList;var bx=bC.createSVGPathSegLinetoAbs(5,5);try{by.replaceItem(bx,0);bg.pathReplaceItem=true}catch(bB){bg.pathReplaceItem=false}try{by.insertItemBefore(bx,0);bg.pathInsertItemBefore=true}catch(bB){bg.pathInsertItemBefore=false}var bE=document.createElementNS(aT,"text");bE.textContent="a";am.appendChild(bE);try{bE.getStartPositionOfChar(0);bg.textCharPos=true}catch(bB){bg.textCharPos=false;aS()}am.removeChild(bE);bg.editableText=k;var bA=document.createElementNS(aT,"rect");bA.setAttribute("x",0.1);var bz=bA.cloneNode(false);bg.goodDecimals=(bz.getAttribute("x").indexOf(",")==-1);if(!bg.goodDecimals){$.alert("NOTE: This version of Opera is known to contain bugs in SVG-edit.\n		Please upgrade to the <a href='http://opera.com'>latest version</a> in which the problems have been fixed.")}var bA=document.createElementNS(aT,"rect");bA.setAttribute("width","1em");bA.setAttribute("height","1ex");am.appendChild(bA);var bD=bA.getBBox();K.em=bD.width;K.ex=bD.height;am.removeChild(bA)}())};